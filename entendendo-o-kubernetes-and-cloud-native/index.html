<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title> Entendendo o Kubernetes &amp; Cloud Native - Guto@Site</title><meta name="description" content="Bora entender isso e ficar na mesma página? Vem com a gente!&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://gutocarvalho.net/entendendo-o-kubernetes-and-cloud-native/"><link rel="amphtml" href="https://gutocarvalho.net/amp/entendendo-o-kubernetes-and-cloud-native/"><link rel="alternate" type="application/atom+xml" href="https://gutocarvalho.net/feed.xml"><link rel="alternate" type="application/json" href="https://gutocarvalho.net/feed.json"><meta property="og:title" content=" Entendendo o Kubernetes & Cloud Native"><meta property="og:site_name" content="Guto@Site"><meta property="og:description" content="Bora entender isso e ficar na mesma página? Vem com a gente!&hellip;"><meta property="og:url" content="https://gutocarvalho.net/entendendo-o-kubernetes-and-cloud-native/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@gutocarvalho"><meta name="twitter:title" content=" Entendendo o Kubernetes & Cloud Native"><meta name="twitter:description" content="Bora entender isso e ficar na mesma página? Vem com a gente!&hellip;"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Asap:400,600,700&amp;display=swap" rel="stylesheet"><style>:root{--body-font:'Asap',sans-serif;--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://gutocarvalho.net/assets/css/style.css?v=47aad078e314013c1a1ca6569eaa9f2f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://gutocarvalho.net/entendendo-o-kubernetes-and-cloud-native/"},"headline":" Entendendo o Kubernetes & Cloud Native","datePublished":"2022-02-16T17:14","dateModified":"2022-02-17T07:14","description":"Bora entender isso e ficar na mesma página? Vem com a gente!&hellip;","author":{"@type":"Person","name":"Guto Carvalho"},"publisher":{"@type":"Organization","name":"Guto Carvalho"}}</script></head><body><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://gutocarvalho.net/quem-sou/" target="_self">Me conheça</a></li><li class="has-submenu"><span>Resume</span><ul class="navbar__submenu"><li><a href="https://resume.gutocarvalho.net" target="_self">ENGLISH</a></li><li><a href="https://curriculo.gutocarvalho.net" target="_self">PORTUGUESE</a></li></ul></li><li class="has-submenu"><span>Posts</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/" target="_self">BLOG</a></li><li><a href="https://twitter.com/gutocarvalho" target="_self">TWITTER</a></li></ul></li><li class="has-submenu"><span>Eu recomendo</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/comunidades/" target="_self">COMUNIDADES</a></li><li><a href="https://gutocarvalho.net/siga-o-pessoal-do-bem/" target="_self">PESSOAS</a></li><li><a href="https://gutocarvalho.net/ferramentas-interessantes-para-k8s/" target="_self">K8S TOOLS</a></li><li><a href="https://gutocarvalho.net/sites-interessantes-para-conhecer/" target="_self">TECH SITES</a></li></ul></li><li class="has-submenu"><span>Opinião</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/etiqueta-do-trabalho-remoto/" target="_self">ETIQUETA NO JOB REMOTO</a></li><li><a href="https://gutocarvalho.net/ti-remota-em-2022-entenda/" target="_self">ENTENDA O JOB REMOTO EM 22</a></li><li><a href="https://gutocarvalho.net/trinta-percepcoes-sobre-ti-em-2022/" target="_self">30 PERCEPCOES SOBRE TI EM 22</a></li><li><a href="https://gutocarvalho.net/quanto-eu-devo-cobrar-a-hora-de-projetos/" target="_self">VALOR HORA DE PROJETOS</a></li><li><a href="https://gutocarvalho.net/quanto-deveria-ganhar-um-cloud-engineer/" target="_self">SALARIO CLOUD ENGINEER</a></li></ul></li><li class="has-submenu"><span>TECH</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/tags/tips/" target="_self">DROPS</a></li><li><a href="https://gutocarvalho.net/tags/projetos/" target="_self">PROJETOS</a></li><li><a href="https://gutocarvalho.net/tags/mindnotes/" target="_self">MIND NOTES</a></li><li><a href="https://gutocarvalho.net/tags/mente/" target="_self">FALAGUTERA</a></li><li><a href="https://gutocarvalho.net/tags/k8s/" target="_self">K8S</a></li></ul></li><li class="has-submenu"><span>Vitae</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/tags/poesia/" target="_self">POESIA</a></li></ul></li><li><a href="https://gutocarvalho.net/archives/" target="_self">ARCHIVED SITES</a></li><li><a href="https://nativetrail.io" target="_self">NativeTrail</a></li><li><a href="https://www.google.com/search?q&#x3D;site%3Agutocarvalho.net" target="_blank">Busca</a></li><li><a href="https://gutocarvalho.net/contato/" target="_self">Contato</a></li></ul></nav><div class="content"><header class="top"><div class="top__item"><a class="logo" href="https://gutocarvalho.net/">Guto@Site</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main"><article class="post"><div class="main__left"><figure class="hero"><img src="https://gutocarvalho.net/media/website/guto.png" srcset="https://gutocarvalho.net/media/website/responsive/guto-xs.png 300w, https://gutocarvalho.net/media/website/responsive/guto-sm.png 480w, https://gutocarvalho.net/media/website/responsive/guto-md.png 768w, https://gutocarvalho.net/media/website/responsive/guto-lg.png 1024w, https://gutocarvalho.net/media/website/responsive/guto-xl.png 1280w, https://gutocarvalho.net/media/website/responsive/guto-2xl.png 1600w" sizes="(min-width: 61.3125em) 50vw, 100vw" loading="eager" width="885" height="802" alt="Guto Carvalho # 2022-01-05 @ BSB"><figcaption class="hero__caption">Guto Carvalho # 2022-01-05 @ BSB</figcaption></figure><header><h1> Entendendo o Kubernetes &amp; Cloud Native</h1><p><time datetime="2022-02-16T17:14">February 16, 2022 </time>by <a href="https://gutocarvalho.net/authors/gutocarvalho/" rel="author" title="Guto Carvalho">Guto Carvalho</a></p></header></div><div class="main__right"><div class="post__entry"><p>Bora entender isso e ficar na mesma página? Vem com a gente!</p><p>Me siga no twitter <a href="https://twitter.com/gutocarvalho">@gutocarvalho</a> e acompanhe meus posts sobre Cloud Native e CI/CD.</p><p>Siga a <a href="https://twitter.com/CDeliveryFdn">CD Foundation</a> e <a href="https://twitter.com/cloudnativefdn">Cloud Native Foundation</a> no twitter.</p><p>Revisor: <a href="https://twitter.com/rkpegoraro">Ricardo Pegoraro</a></p><h2 id="o-que-é">O que é?</h2><p>O kubernetes é um orquestrador de containers que oferece meios para você executar, escalar e atualizar seu software de forma simples e eficiente.</p><p>Com o kubernetes podemos automatizar a implantação de nosso software integrando nossa pipeline com um cluster de containers, conseguindo assim entregar nosso software de maneira rápida e controlada.</p><h2 id="origens">Origens</h2><p>Em 2014 o google liberou um projeto open source interno que orquestrava containers, ele foi a base para o Kubernetes.</p><h3 id="curiosidades-sobre-as-origens">Curiosidades sobre as origens</h3><p>No Google, internamente o projeto se chamava BORG.</p><p>O projeto BORG foi reescrito em GO e foi rebatizado de Kubernetes.</p><p>Kubernetes significa timoneiro – em grego, aquele que pilota uma embarcação.</p><p>A primeira release do kubernetes foi lançada em 7 de Junho de 2014.</p><h2 id="cloud-native-computing-foundation-ou-cncf">Cloud Native Computing Foundation ou CNCF</h2><p>O Google queria algum lugar para hospedar não só o projeto Kubernetes em si, mais um lugar em que todos pudessem contribuir com o projeto e criar novas soluções para esse segmento de aplicações rodando em containers.</p><p>Com essa ideia em mente, o Google entrou em contato com a Linux Foundation para criar uma estrutura que pudesse receber esse projeto e fomentar tecnologias e soluções ligadas a esse novo universo de containers.</p><p>A Linux Foundation criou então a CNCF, Cloud Native Computing Foundation para fomentar o desenvolvimento do Kubernetes e de tecnologias com foco em containers. O Termo Cloud Native foi cunhado e passou a ser utilizado para se referir aplicações desta natureza.</p><p>A CNCF foi fundada e teve seu anúncio junto com o lançamento da versão 1.0 do Kubernetes em 21 de Julho de 2015.</p><h2 id="como-funciona-">Como funciona ?</h2><p>O Kubernetes ou K8S como é chamado de forma abreviada é um orquestrador que foi desenhado para gerenciar workloads de containers e serviços de forma automatizada, utilizando configuração declarativa que uso o estrutura e formato do projeto YAML.</p><p>Isso significa que podemos definir o estado desejado de funcionamento de nosso cluster e também das aplicações rodando neste, apenas utilizando convenções em YAML. Os operadores do cluster vão ler essas definições e garantir esse estado, fazendo modificações quando for necessário.</p><p>O kubernetes vai oferecer:</p><ul><li>Serviço de descoberta</li><li>Serviço de balanceamento de carga</li><li>Serviço de proxy</li><li>Gerenciamento de redes e sub-redes</li><li>Gerenciamento de DNS</li><li>Orquestração de storage para os containers</li><li>Automação do rollouts ou rollbacks de suas aplicações</li><li>Gerenciamento dos certificados (geração automática de certificados SSL)</li><li>Gerenciamento de configuraçoes (configmaps)</li><li>Gerenciamento de segredos (secrets)</li><li>Gerenciamento de jobs (cronjobs)</li><li>Gerenciamento de limites de recursos para cada container</li><li>Self-healing, ele reinicia ou substitiu um container em caso de falha</li></ul><p>Em resumo, o kubernetes vai oferecer tudo que é necessário para sua aplicação rodar e ser acessada por seus usuários.</p><h3 id="por-que-chamam-o-k8s-de-os-de-datacenter">Por que chamam o K8S de OS de Datacenter?</h3><p>Em alguns treinamentos ou palestras você pode ouvir o pessoal falando que o BORG ou Kubernetes era um sistema operacional de datacenter, e tudo bem, faz sentido. Uma vez que o kubernetes oferece tudo que um software precisa, indo do endereço ip, rede, storage, balanceamento, dns, certificado, configurações, segredos, ele traz tudo que um datacenter ofereceria para uma aplicação em um lugar só, e essa é beleza e a força do projeto.</p><h2 id="quais-os-benefícios">Quais os benefícios?</h2><p>Como o kubernetes oferece tudo que sua aplicação precisa, você tem mais tempo para se preocupar com o negócio, isso pode melhorar sua produtividade e reduzir tempo gasto com configurações comuns geralmente executados em sua infraestrutura clássica.</p><p>O uso de cluster kubernetes nos ajuda a usar os recursos computacionais de forma mais eficiente. Como tudo roda em containers, conseguimos compartilhar mais recursos computacionais com diferentes aplicações sendo executadas.</p><p>O processo de entrega e o ciclo de desenvolvimento do software pode ser sensivelmente reduzido depois de integrar o cluster ao seu processo de desenvolvimento.</p><p>Uma vez que sua aplicação está rodando em Kubernetes, você conseguirá rodá-la praticamente em quaisquer cloud pública que suporte kubernetes. Essa portabilidade é muito importante e oferece a capacidade de funcionar em diferentes clouds, podendo escolher aquela com melhor custo, ou até replicar sua aplicação em provedores diferentes para garantir mais disponibilidade.</p><p>Ao usar aplicações dentro do cluster, você conseguirá reduzir sensivelmente o custo em um Cloud Pública se compararmos com instâncais comuns (VMS) e serviços como Load Balancer, Storage, dentre outros.</p><p>O Kubernetes é o orquestrador líder de mercado, é comprovamente estável, é mantido por diversas empresas incluindo o Google e foi testado em produção em diversos cenários com sucesso, o que nos garante que não estamos embarcando em uma aventura com uma nova tecnologia. Existem muitos cases de aplicações de missão crítica rodando em clusters Kubernetes, se é eficiente para eles, é eficiente para você.</p><h2 id="é-realmente-seguro">É realmente seguro?</h2><p>Sim é seguro, contudo, como qualquer outro software ou plataforma a segurança tem que fazer parte de suas preocupações desde o momento do design de seu cluster.</p><p>Coisas como:</p><ul><li>Escolher uma distribuição kubernetes certificada pela CNCF</li><li>Escolher um OS base mínimo, com foco em K8S</li><li>Remover credenciais e acessos desnecessários</li><li>Evitar rodar qualquer coisa com privilégios de ROOT</li><li>Seguir todas as boas práticas de segurança para clusters K8S</li><li>Fazer o hardeding de seus clusters</li><li>Instalar ferramentas para verificar a segurança de seu cluster regularmente</li><li>Centralizar e acompanhar os logs do cluster e das APPs</li><li>Centralizar e acompanhar as métricas do cluster e das APPs</li><li>Inserir segurança no processo de desenvolvimento de suas APPS desde o dia zero</li></ul><p>Seguindo essas dicas você terá tanto um cluster quando APPs seguras rodando nele.</p><h2 id="consigo-rodar-meu-software-nele">Consigo rodar meu software nele?</h2><p>Consegue sim, mesmo se for um monolito.</p><p>Diferente do que muitos pensam o Kubernetes pode rodar qualquer software que esteja embarcado em um container, seja um monolito, um microserviço ou uma API.</p><p>Obviamente se você estiver iniciando o desenvolvimento do seu software o ideal é pensar em decompor sua solução em microserviços que se comunicam via API, pensar em aplicações do tipo stateless, pensar em aplicações que podem rodar em múltiplos nodes e pods, pensar em uso de banco de dados externo, pensar em persistência e armazenamento de arquivos usando storage de objetos – estilo S3 – dentre outras boas práticas de APPs Cloud Native.</p><p>Seguindo essas dicas, você terá de fato uma aplicação Cloud Native que poderá usar o melhor do Kubernetes, sua aplicação conseguirá escalar horizontalmente e atender a demanda crescente de seus usuários.</p><h2 id="consigo-rodar-kubernetes-on-premisses">Consigo rodar Kubernetes on-premisses?</h2><p>Sim consegue, existem excelentes distribuições para rodar On-Premisses, uma delas é o RKE da Rancher.</p><p>Quando falamos de on-premisses, precisamos pensar em um desenho robusto de nosso cluster, lembrar que precisamos de redudância entre hypervisors, backup real e eficiente, load balancer L4, centralização de logs, monitoramento, avaliação de métricas e performance, gerenciamento de certificados dentre outras coisas que precisam ser configuradas e levadas em conta para termos um cluster on-premisses rodando de forma segura, estável e performática.</p><h2 id="consigo-rodar-kubernetes-em-meu-provedor-de-nuvem">Consigo rodar Kubernetes em meu provedor de nuvem?</h2><p>Sim consegue também, rodando em instâncias virtuais da mesma forma como rodaria on-premisses ou usando serviços gerenciados do provedor.</p><h2 id="vale-a-pena-usar-o-kubernetes-gerenciado">Vale a pena usar o kubernetes gerenciado?</h2><p>Vale muito, especialmente se seu time é mais focado em desenvolvimento do que em infraestrutura.</p><p>No caso de plataformas gerenciadas como EKS da AWS, GKS do Google, AKS da Azure, OKE da Oracle ou mesmo o Kubernetes gerenciado da Jelastic/SaveinCloud toda a parte da configuração e funcionamento do cluster, em especial os nós de controle, são mantidos pelo provedor, você só se preocupa com seus workloads e os nós do tipo worker que serão registrados no cluster que foi criado.</p><p>Com um kubernetes gerenciado você pode focar em seu negócio e deixar a infra com o provedor, é o melhor cenário para uma empresa com um time pequeno de desenvovledores ou um time sem engenheiros de nuvem.</p><h2 id="o-que-são-aplicações-cloud-native">O que são aplicações Cloud Native?</h2><p>Aplicações Cloud Native são aquelas que já são construídas pensando em se beneficiar de recursos da computação em nuvem. E neste caso, isso esta intimamente ligado ao uso de containers e a orquestração destes.</p><p>Características de aplicações Cloud Native</p><ul><li>Uso da Cultura DevOps no dia-a-dia do time do produto</li><li>Uso de métodos ágeis no desenvolvimento do produto</li><li>Uso de arquitetura de microserviços e API-First</li><li>Foco em oferecer métricas de seus componentes desde o dia zero</li><li>Foco em oferecer amplo monitoramento de suas features desde o dia zero</li><li>Foco em portabilidade e execução multi-cloud desde o dia zero</li><li>Abstração de sistema operacional com uso de containers</li><li>Uso de pipelines de integração contínua no processo de desenvolvimento</li><li>Uso de pipelines de entrega contínua para publicar seu software</li><li>Software desenhado para rodar como “Stateless”</li><li>Software pensado para uso de storage de objetos ao invés de filesystem</li><li>Software pensado para funcionar em cenários de escalabilidade horizontal</li><li>Software pensado para rodar em clusters de containers como kubernetes ou nomad</li><li>Software pensado para ser resiliente a falhas, onde possamos usar chaos engineering para testá-lo</li><li>Foco na rápida entrega de atualizações e novidades para seus usuários</li><li>Foco na capacidade de fazer rollback de forma fácil e simples caso seja nesessário</li></ul><p>Eu acrescentaria ainda:</p><ul><li>Suporte nativo a Kubernetes e Docker</li></ul><p>Basicamente são essas as características que representam uma APP Cloud Native hoje, pelo menos em minha humilde opinião.</p><h2 id="amarrando-as-pontas">Amarrando as pontas</h2><p>Espero que eu tenha conseguido explicar o projeto Kubernetes e o conceito de Cloud Native para você.</p><p>Em breve falaremos da arquitetura do Kubernetes! :)</p><p>[s]<br>Guto</p><hr><p>Este post é do tipo #TLDR, entenda <a href="https://gutocarvalho.net/o-que-sao-tldrs/">aqui</a>.</p><p>Se gostou manda um alo no twitter <a href="https://twitter.com/gutocarvalho">@gutocarvalho</a>.</p><footer><div class="post__tag-share"><ul class="post__tag"><li><a href="https://gutocarvalho.net/tags/tldr/">TLDR</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fgutocarvalho.net%2Fentendendo-o-kubernetes-and-cloud-native%2F" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fgutocarvalho.net%2Fentendendo-o-kubernetes-and-cloud-native%2F&amp;via=gutocarvalho&amp;text=%C2%A0Entendendo%20o%20Kubernetes%20%26%20Cloud%20Native" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fgutocarvalho.net%2Fentendendo-o-kubernetes-and-cloud-native%2F&amp;title=%C2%A0Entendendo%20o%20Kubernetes%20%26%20Cloud%20Native" class="js-share linkedin" aria-label="[MISSING TRANSLATION] Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://api.whatsapp.com/send?text=%C2%A0Entendendo%20o%20Kubernetes%20%26%20Cloud%20Native https%3A%2F%2Fgutocarvalho.net%2Fentendendo-o-kubernetes-and-cloud-native%2F" class="js-share whatsapp" title="[MISSING TRANSLATION] Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#whatsapp"/></svg></a></div></div><div class="post__bio"><img src="https://gutocarvalho.net/media/website/guto_22_02.png" loading="lazy" alt="Guto Carvalho"><h3><a href="https://gutocarvalho.net/authors/gutocarvalho/" title="Guto Carvalho">Guto Carvalho</a></h3><p>Navegando pelas nuvens nativas e pipelines infinitas.</p></div></footer></div></div></article></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/falagutera" class="facebook" aria-label="Facebook"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://www.twitter.com/gutocarvalho" class="twitter" aria-label="Twitter"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/falagutera" class="instagram" aria-label="Instagram"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/falagutera/" class="linkedin" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/falagutera" class="youtube" aria-label="Youtube"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright">License<br>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.<br>Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></div></footer></div></div><script defer="defer" src="https://gutocarvalho.net/assets/js/scripts.min.js?v=babd20e2a0a25821e63a0529c9feaae0"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>Esse site usa cookies</h2><p>Esse site usa cookies apenas para verificar suas configurações de browser e melhorar sua experiência na navegação. Não guardaremos seus dados. <a href="#not-specified"></a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Experiência do usuário</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookies Policy</span></div><script>(function() {
                   function addScript (src, inline) {
                       var newScript = document.createElement('script');
   
                       if (src) {
                           newScript.setAttribute('src', src);
                       }
   
                       if (inline) {
                           newScript.text = inline;
                       }
   
                       document.body.appendChild(newScript);
                   }
   
                   var popup = document.querySelector('.js-cookie-popup');
                   var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                   var save = popup.querySelector('button');
                   var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                   var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                   
   
                   popup.addEventListener('click', function() {
                       if (!popup.classList.contains('cookie-popup--is-sticky')) {
                           popup.classList.add('cookie-popup--is-sticky');
                       }
                   });
   
                   save.addEventListener('click', function(e) {
                       e.preventDefault();
                       e.stopPropagation();
                       popup.classList.remove('cookie-popup--is-sticky');
                       var allowedGroups = [];
   
                       for (var i = 0; i < checkboxes.length; i++) {
                           if (checkboxes[i].checked) {
                               var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                               var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');
   
                               for (var j = 0; j < scripts.length; j++) {
                                   addScript(scripts[j].src, scripts[j].text);
                               }
   
                               allowedGroups.push(groupName);
                           }
                       }
   
                       localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                       popup.classList.remove('cookie-popup--is-sticky');
   
                       setTimeout(function () {
                           if (currentConfig !== null) {
                               window.location.reload();
                           }
                       }, 250);
                   });
   
                   if (currentConfig === null) {
                       popup.classList.add('cookie-popup--is-sticky');
                       var checkedGroups = popup.querySelectorAll('input[type="checkbox"]:checked');
   
                       for (var i = 0; i < checkedGroups.length; i++) {
                           var allowedGroup = checkedGroups[i].name.replace('gdpr-', '');
   
                           if (allowedGroup !== '-' && allowedGroup !== '') {
                               var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
   
                               for (var j = 0; j < scripts.length; j++) {
                                   addScript(scripts[j].src, scripts[j].text);
                               }
                           }
                       }
                   } else {
                       if (currentConfig !== '') {
                           var allowedGroups = currentConfig.split(',');
                           var checkedCheckboxes = popup.querySelectorAll('input[type="checkbox"]:checked');
   
                           for (var j = 0; j < checkedCheckboxes.length; j++) {
                               var name = checkedCheckboxes[j].name.replace('gdpr-', '');
   
                               if (allowedGroups.indexOf(name) === -1) {
                                   checkedCheckboxes[j].checked = false;
                               }
                           }
   
                           for (var i = 0; i < allowedGroups.length; i++) {
                               var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                               var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');
   
                               if (checkbox) {
                                   checkbox.checked = true;
                               }
   
                               for (var j = 0; j < scripts.length; j++) {
                                   addScript(scripts[j].src, scripts[j].text);
                               }
                           }
                       }
                   }
               })();</script></body></html>