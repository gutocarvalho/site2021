<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Guto@Site</title>
    <link href="https://gutocarvalho.net/feed.xml" rel="self" />
    <link href="https://gutocarvalho.net" />
    <updated>2021-11-18T10:54:36-03:00</updated>
    <author>
        <name>Guto Carvalho</name>
    </author>
    <id>https://gutocarvalho.net</id>

    <entry>
        <title>Dashboards para K8S</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/dashboards-para-k8s/"/>
        <id>https://gutocarvalho.net/dashboards-para-k8s/</id>
            <category term="MindNotes"/>

        <updated>2021-11-18T10:54:36-03:00</updated>
            <summary>
                <![CDATA[
                    Quer usar Dashboards para o Kubernetes? Bora! Algumas opções bastante conhecidas Projetos&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Quer usar Dashboards para o Kubernetes? Bora!</p>
<p>Algumas opções bastante conhecidas</p>
<ul>
<li><a href="https://rancher.com/docs/rancher/v2.6/en/">https://rancher.com/docs/rancher/v2.6/en/</a></li>
<li><a href="https://github.com/kubernetes/dashboard">https://github.com/kubernetes/dashboard</a></li>
<li><a href="https://www.portainer.io">https://www.portainer.io</a></li>
<li><a href="https://www.weave.works/oss/scope">https://www.weave.works/oss/scope</a></li>
</ul>
<p>Projetos promissores</p>
<ul>
<li><a href="https://octant.dev">https://octant.dev</a></li>
<li><a href="https://github.com/skooner-k8s/skooner">https://github.com/skooner-k8s/skooner</a></li>
<li><a href="https://kubevious.io">https://kubevious.io</a> (esse é bem interessante)</li>
</ul>
<p>Para terminal</p>
<ul>
<li><a href="https://codeberg.org/hjacobs/kube-ops-view">https://codeberg.org/hjacobs/kube-ops-view</a></li>
<li><a href="https://k9scli.io">https://k9scli.io</a></li>
</ul>
<p>Para seu desktop</p>
<ul>
<li><a href="https://k8slens.dev">https://k8slens.dev</a></li>
<li><a href="https://kubenav.io">https://kubenav.io</a></li>
</ul>
<p>Para conhecer e testar</p>
<ul>
<li><a href="https://github.com/jeremykross/konstellate">https://github.com/jeremykross/konstellate</a></li>
<li><a href="https://github.com/smpio/kubernator">https://github.com/smpio/kubernator</a></li>
<li><a href="https://github.com/kubricksllc/Kubricks">https://github.com/kubricksllc/Kubricks</a></li>
</ul>
<p>Gerador de relatórios de custos para AWS e GCP</p>
<ul>
<li><a href="https://codeberg.org/hjacobs/kube-resource-report">https://codeberg.org/hjacobs/kube-resource-report</a></li>
</ul>
<p>[s]</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Instalando ISTIO via helm para testes</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/instalando-istio-via-helm-para-testes/"/>
        <id>https://gutocarvalho.net/instalando-istio-via-helm-para-testes/</id>
            <category term="Projetos"/>
            <category term="K8S"/>
            <category term="Drops"/>

        <updated>2021-11-08T16:32:24-03:00</updated>
            <summary>
                <![CDATA[
                    Aprendar a instalar o Istio via Helm em poucos passos. O Istio&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprendar a instalar o Istio via Helm em poucos passos.</p>
<hr>
<p>O Istio é uma implementação de service mesh, falaremos oq é isso em outro post!</p>
<h2 id="instalando">Instalando</h2>
<p>crie um diretório</p>
<pre><code>$ mkdir istio &amp;&amp; cd istio
</code></pre>
<p>baixe o pacote</p>
<pre><code>$ curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.11.4 TARGET_ARCH=x86_64 sh -
</code></pre>
<p>Crie o namespace</p>
<pre><code>$ kubectl create namespace istio-system 
</code></pre>
<p>Instale o pacote base (CRD’s)</p>
<pre><code>$ helm install istio-base istio-1.11.4/manifests/charts/base -n istio-system
</code></pre>
<p>Instale o istiod (Services)</p>
<pre><code>$ helm install istiod istio-1.11.4/manifests/charts/istio-control/istio-discovery -n istio-system
</code></pre>
<p>Instale o istio ingress (opcional)</p>
<pre><code>$ helm install istio-ingress istio-1.11.4/manifests/charts/gateways/istio-ingress -n istio-system
</code></pre>
<p>Instale o istio egress (opcional)</p>
<pre><code>$ helm install istio-egress istio-1.11.4/manifests/charts/gateways/istio-egress -n istio-system
</code></pre>
<h2 id="validando">Validando</h2>
<p>Verifique</p>
<pre><code>$ kubectl get pods -n istio-system
</code></pre>
<p>Saída esperada</p>
<pre><code>NAME                                    READY   STATUS    RESTARTS   AGE
istio-egressgateway-6674469d89-zz4h8    1/1     Running   0          12m
istio-ingressgateway-55cf46987b-5lcxj   1/1     Running   0          13m
istiod-7556556fcc-7bcf8                 1/1     Running   0          13m
</code></pre>
<p>Verifique</p>
<pre><code>$ kubectl get istio-io --all-namespaces
</code></pre>
<p>Saída esperada</p>
<pre><code>NAMESPACE      NAME                                                         AGE
istio-system   envoyfilter.networking.istio.io/metadata-exchange-1.10       13m
istio-system   envoyfilter.networking.istio.io/metadata-exchange-1.11       13m
istio-system   envoyfilter.networking.istio.io/metadata-exchange-1.9        13m
istio-system   envoyfilter.networking.istio.io/stats-filter-1.10            13m
istio-system   envoyfilter.networking.istio.io/stats-filter-1.11            13m
istio-system   envoyfilter.networking.istio.io/stats-filter-1.9             13m
istio-system   envoyfilter.networking.istio.io/tcp-metadata-exchange-1.10   13m
istio-system   envoyfilter.networking.istio.io/tcp-metadata-exchange-1.11   13m
istio-system   envoyfilter.networking.istio.io/tcp-metadata-exchange-1.9    13m
istio-system   envoyfilter.networking.istio.io/tcp-stats-filter-1.10        13m
istio-system   envoyfilter.networking.istio.io/tcp-stats-filter-1.11        13m
istio-system   envoyfilter.networking.istio.io/tcp-stats-filter-1.9         13m
</code></pre>
<h2 id="removendo">Removendo</h2>
<p>Numa tacada só</p>
<pre><code>$ helm uninstall istio-base istio-egress istio-ingress istiod -n istio-system
</code></pre>
<p>Saída esperada</p>
<pre><code>release &quot;istio-base&quot; uninstalled
release &quot;istio-egress&quot; uninstalled
release &quot;istio-ingress&quot; uninstalled
release &quot;istiod&quot; uninstalled
</code></pre>
<p>Removendo o namespace</p>
<pre><code>$ kubectl delete namespace istio-system
</code></pre>
<pre><code>namespace &quot;istio-system&quot; deleted
</code></pre>
<p>Removendo CRDs</p>
<pre><code>$ kubectl get crd | grep --color=never &#39;istio.io&#39; | awk &#39;{print $1}&#39;| xargs -n1 kubectl delete crd
</code></pre>
<p>Saída esperada</p>
<pre><code>customresourcedefinition.apiextensions.k8s.io &quot;adapters.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;attributemanifests.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;authorizationpolicies.security.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;clusterrbacconfigs.rbac.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;destinationrules.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;envoyfilters.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;gateways.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;handlers.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;httpapispecbindings.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;httpapispecs.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;instances.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;istiooperators.install.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;peerauthentications.security.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;quotaspecbindings.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;quotaspecs.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;rbacconfigs.rbac.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;requestauthentications.security.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;rules.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;serviceentries.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;servicerolebindings.rbac.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;serviceroles.rbac.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;sidecars.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;telemetries.telemetry.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;templates.config.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;virtualservices.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;workloadentries.networking.istio.io&quot; deleted
customresourcedefinition.apiextensions.k8s.io &quot;workloadgroups.networking.istio.io&quot; deleted
</code></pre>
<h2 id="refs">Refs</h2>
<ul>
<li><a href="https://istio.io/latest/docs/setup/getting-started/">https://istio.io/latest/docs/setup/getting-started/</a></li>
<li><a href="https://istio.io/latest/docs/setup/install/">https://istio.io/latest/docs/setup/install/</a></li>
<li><a href="https://istio.io/latest/docs/setup/install/helm/">https://istio.io/latest/docs/setup/install/helm/</a></li>
</ul>

            ]]>
        </content>
    </entry>
    <entry>
        <title>Dicas sobre quadros e canetas!</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/dicas-sobre-quadros-e-canetas/"/>
        <id>https://gutocarvalho.net/dicas-sobre-quadros-e-canetas/</id>
            <category term="Casa"/>

        <updated>2021-11-06T06:28:30-03:00</updated>
            <summary>
                <![CDATA[
                    <p>Pessoal, seguem algumas dicas sobre quadros para escrever em casa.</p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Pessoal, seguem algumas dicas sobre quadros para escrever em casa.</p>

<figure class="post__image">Eu sou desses que tem vários quadros – para escrever com canetinha – em casa, tenho de vidro, de metal, de madeira, e outros tipos, eu gosto de escrever para lembrar das coisas, para deixar recados para as crianças, para deixar recados pra mim, para organizar atividades. Eu acho que os quadros sempre estiverem presentes na minha vida, eu não sei viver sem eles.<br><br><img loading="lazy"  src="https://gutocarvalho.net/media/posts/72/quadro_vidro.jpg" sizes="(min-width: 61.3125em) 50vw, 100vw" srcset="https://gutocarvalho.net/media/posts/72/responsive/quadro_vidro-xs.jpg 300w ,https://gutocarvalho.net/media/posts/72/responsive/quadro_vidro-sm.jpg 480w ,https://gutocarvalho.net/media/posts/72/responsive/quadro_vidro-md.jpg 768w"  alt="" width="1280" height="960"></figure><br><br>Eu escrevo até nos espelhos :)</p>
<div class="gallery-wrapper"><div class="gallery"  data-is-empty="false" data-columns="2">
<figure class="gallery__item"><a href="https://gutocarvalho.net/media/posts/72/gallery/espelho1-2.jpg" data-size="960x1280"><img loading="lazy" src="https://gutocarvalho.net/media/posts/72/gallery/espelho1-2-thumbnail.jpg" alt="" width="768" height="1024"></a></figure>
<figure class="gallery__item"><a href="https://gutocarvalho.net/media/posts/72/gallery/espelho2-2.jpg" data-size="960x1280"><img loading="lazy" src="https://gutocarvalho.net/media/posts/72/gallery/espelho2-2-thumbnail.jpg" alt="" width="768" height="1024"></a></figure>
</div></div>
<p><br>Usando tantos quadros, por tantos anos, especialmente de vidro, a gente acaba experimentando uma série de canetas e aprendendo sobre elas. <br><br>Fiz esse post para ajudar você a escolher o melhor tipo de caneta e quadro para sua casa/escritório.<br><br><strong>Canetas com ponta grossa ( traço de 2 a 5 mm )</strong><br><br>No quesito caneta com ponta grossa, eu gosto muito das canetas da <a href="https://www.compactor.com.br/marcadores-qb/">compactor</a> para quadro branco, são excelentes, uso há cerca de dois anos, e virou minha caneta padrão devido a qualidade e custo vs benefício.<br><br></p>
<figure class="post__image"><img loading="lazy"  src="https://gutocarvalho.net/media/posts/72/Screen-Shot-2021-11-05-at-12.35.11.png" sizes="(min-width: 61.3125em) 50vw, 100vw" srcset="https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.35.11-xs.png 300w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.35.11-sm.png 480w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.35.11-md.png 768w"  alt="" width="562" height="540"></figure>
<p>Elas funcionam muito bem para desenhar no geral, e no meu caso para rabiscar umas topologias, arquiteturas, redes, etc, ajuda muito no troubleshooting, na proposição de projetos e uso principalmente como "lista de coisas a fazer" :)<br><br>Ela está disponível nas cores azul, preta, vermelha, verde e rosa.<br><br>Sua ponta cônica é muito confortável e firme.<br><br>Oferece reservatório para recarga.<br><br><strong>Canetas com ponta fina ( traço de 1 a 2 mm )</strong></p>
<p>Em alguns casos ponta grossa pode ser um problema, especialmente em quadros personalizados com pouco espaço para escrever, nestes quadros eu uso as canetas da <a href="https://www.staedtler.com/br/pt/produtos/marcador/marcador-para-quadro-branco/">staedtler</a> lumocolor whiteboard, são maravilhosas.</p>
<figure class="post__image"><img loading="lazy"  src="https://gutocarvalho.net/media/posts/72/Screen-Shot-2021-11-05-at-12.37.01.png" sizes="(min-width: 61.3125em) 50vw, 100vw" srcset="https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.37.01-xs.png 300w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.37.01-sm.png 480w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.37.01-md.png 768w"  alt="" width="441" height="431"></figure>
<p> </p>
<p><strong>Exemplo de traço grosso</strong><br><br></p>
<div class="gallery-wrapper"><div class="gallery"  data-is-empty="false" data-columns="2">
<figure class="gallery__item"><a href="https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_grosso-3.jpg" data-size="1280x960"><img loading="lazy" src="https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_grosso-3-thumbnail.jpg" alt="" width="768" height="576"></a></figure>
<figure class="gallery__item"><a href="https://gutocarvalho.net/media/posts/72/gallery/semana_traco_grosso-4.jpg" data-size="1280x960"><img loading="lazy" src="https://gutocarvalho.net/media/posts/72/gallery/semana_traco_grosso-4-thumbnail.jpg" alt="" width="768" height="576"></a></figure>
</div></div>
<p><strong>Exemplo de Traço fino</strong><br><br></p>
<div class="gallery-wrapper"><div class="gallery"  data-is-empty="false" data-columns="2">
<figure class="gallery__item"><a href="https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_fino.jpg" data-size="1280x960"><img loading="lazy" src="https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_fino-thumbnail.jpg" alt="" width="768" height="576"></a></figure>
<figure class="gallery__item"><a href="https://gutocarvalho.net/media/posts/72/gallery/semana_traco_fino.jpg" data-size="1280x960"><img loading="lazy" src="https://gutocarvalho.net/media/posts/72/gallery/semana_traco_fino-thumbnail.jpg" alt="" width="768" height="576"></a></figure>
</div></div>
<p><br>Yeah, minha letra é complexa e exótica.<br><br><strong>Outras canetas que recomendo</strong><br><br>Já usei as canetas <a href="http://www.pilotpen.com.br/produtos/marc-wbma-v-board-master-para-quadro-branco/">Pilot Board Master</a> recarregáveis, mais parei devido ao preço e a dificuldade de achar as recargas, fora que a recarga tava o preço da caneta, ai não compensava. Apesar de terem viajado no preço, são canetas boas , tem o traço grosso de 2 a 5 mm, são realmente bem bacanas especialmente para dar aulas, usei de 2013 a 2019 em especial, falando dessa marca e modelo.</p>
<p>Recentemente descobri também as canetas da Faber Castell, são equivalentes ao Pilot Board Master e a Compactor.</p>
<p>Quando as crianças querem desenhar eu compro uns kits de 4 canetas da bic, keep ou pilot modelo wbm-7, são mais baratas e viáveis para eles, do contrario eles acabam com minhas canetas pessoais em uma tarde.</p>
<p><strong>Falando de Quadros</strong><br><br>Eu gosto desses quadros personalizados, eles normalmente são de metal, madeira ou até papelão, contudo hoje em dia eu prefiro quadros de vidro, vou até tentar refazer esses dois da foto acima em vidro com adesivagem similar.<br><br><strong><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;">Quadros de vidro tem muitas vantagens, dentre elas:</span></strong></p>
<p>- São mais bonitos<br>- São mais discretos<br>- Eles encaixam melhor na sua decoração<br>- São fáceis de limpar<br>- São simples de instalar<br>- Qualquer vidraçaria faz<br><br><strong>Alguns cuidados ao comprar na vidraçaria</strong><br><br>- Sempre use vidro temperado, especialmente se tem crianças em casa<br>- A espessura mínima é 4mm, mas eu uso de 8mm pra frente<br>- Instale encostado na parede, ele fica mais firme e seguro, sendo mais difícil quebrar<br><br><strong>Opções no mercado</strong></p>
<p>O pessoal da Easy Office oferece bons quadros de vidro, inclusive magnéticos, algo que não dá para pedir na vidraçaria. Os meus eu comprei na Kalunga.<br><br><strong>Custo vs Benefício dos quadros</strong><br><br>Os quadros de madeira são mais baratos, mas essencialmente tem vida útil menor e com o tempo eles perdem aquela camada de "verniz", deixando tudo bem dificil de apagar.<br><br>Os quadros de metal são interessantes, mas geralmente eles tem um tema, é difícil achar um todo branco para comprar, e nas minhas muitas mudanças vários amassaram as pontinhas.<br><br><strong>Dicas soltas</strong><br><br>Não use apagador, prefira panos de microfibra, funciona 1000x melhor.<br><br>Se sua parede é branca, e se instalar encostado na parede, nem precisará de fundo branco adesivado ou pintado – apesar de recomendar para dar uma uniformidade na cor.<br><br>Se for instalar afastado da parede com pinos de 5cm o 10cm, o fundo branco pintado ou adesivado é fundamental para conseguir ler o que escreveu no quadro. Mas é dificil limpar na parte de trás e se apoiar nele pode quebrar, tem que temperar e usar de 8 a 10mm.<br><br><strong>Quadros que nem vemos</strong><br><br>Eu escrevo nas janelas, vidros da varanda e até nos espelhos, essas canetinhas são muito funcionais e uma simples janela pode virar um quadro para deixar uma mensagem, um lembrete ou simplesmente para desenhar e soltar sua criatividade.</p>
<p><strong>Dicas Kids</strong><br><br>Como as canetas são relativamente caras, especialmente se tratando de crianças, eles acabam com a tinta de 1 kit em uma tarde. Pensando nisso, no quarto das crianças eu pintei em uma parede um quadro usando tinta "lousa &amp; cor" da suvinil.</p>
<figure class="post__image"><img loading="lazy"  src="https://gutocarvalho.net/media/posts/72/lousa_kids.jpg" sizes="(min-width: 61.3125em) 50vw, 100vw" srcset="https://gutocarvalho.net/media/posts/72/responsive/lousa_kids-xs.jpg 300w ,https://gutocarvalho.net/media/posts/72/responsive/lousa_kids-sm.jpg 480w ,https://gutocarvalho.net/media/posts/72/responsive/lousa_kids-md.jpg 768w"  alt="" width="960" height="1280"></figure><br><br>Esse é o quarto/brinquedoteca/sala de estudo aq de casa, quando as crianças vem pra cá usam esse espaço para tudo, inclusive para desenhar.</p>
<p>Nessa parede eles podem escrever com giz normal ou giz líquido. As canetinhas de giz líquido duram bem mais que as canetinhas de quadro branco, tenho usado da marca <a href="https://b2b.brwsuprimentos.com.br/produto/listar/giz-liquido-o">BRW.</a></p>
<p>A grande vantagem é que quando acaba o Giz Líquido eles continuam com o giz normal, que é baratinho :)<br><br>Espero que gostem das dicas!<br><br>[s]</p>
<p> </p>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Criando um Cluster K8S com EKSCTL</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/criando-um-cluster-k8s-com-eksctl/"/>
        <id>https://gutocarvalho.net/criando-um-cluster-k8s-com-eksctl/</id>
            <category term="K8S"/>
            <category term="Drops"/>

        <updated>2021-11-02T11:37:55-03:00</updated>
            <summary>
                <![CDATA[
                    Aprende aí como fazer isso com uma mão nas costas! Criando um&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprende aí como fazer isso com uma mão nas costas!</p>
<hr>
<p>Criando um cluster para testes de forma rápida e rasteira, vamo nessa!</p>
<pre><code>$ eksctl create cluster \
    --region us-east-1 \
    --name falagutera \
    --version 1.21 \
    --node-type t3.xlarge \
    --nodes 3 \
    --ssh-public-key &quot;~/nativetrail.pub&quot;
</code></pre>
<p>gerando o kubeconfig</p>
<pre><code>$ aws eks --region us-east-1 update-kubeconfig --name falagutera
$ export KUBECONFIG=config
</code></pre>
<p>checando o cluster baby</p>
<pre><code>$ kubectl get nodes
</code></pre>
<p>terminou o teste? bora derrubar tudo!</p>
<pre><code>$ eksctl delete cluster falagutera
</code></pre>
<p>pronto!</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Usando EFS em um Cluster K8S EC2</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/usando-efs-em-um-cluster-k8s-ec2/"/>
        <id>https://gutocarvalho.net/usando-efs-em-um-cluster-k8s-ec2/</id>
            <category term="K8S"/>
            <category term="Drops"/>

        <updated>2021-10-25T08:03:34-03:00</updated>
            <summary>
                <![CDATA[
                    Aprenda a usar o EFS Provisioner em um Cluster K8S EC2/RKE. São&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprenda a usar o EFS Provisioner em um Cluster K8S EC2/RKE.</p>
<hr>
<h3 id="o-que-são-drops">O que são drops?</h3>
<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>
<p>Geralmente de algo que eu acabei de fazer.</p>
<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>
<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>
<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>
<h3 id="veio-a-demanda">Veio a Demanda!</h3>
<p>A ideia é instalar um EFS Provisioner no cluster para poder subir APPS que montam o mesmo volume em diferentes PODs.</p>
<h3 id="então-comofaz">Então ComoFaz?</h3>
<p>Crie o arquivo instala_efs_provisioner.yaml</p>
<pre><code>vim aplica.yaml
</code></pre>
<p>Insira o conteúdo abaixo</p>
<pre><code>---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: efs-provisioner-runner
rules:
  - apiGroups: [&quot;&quot;]
    resources: [&quot;persistentvolumes&quot;]
    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;delete&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;persistentvolumeclaims&quot;]
    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;update&quot;]
  - apiGroups: [&quot;storage.k8s.io&quot;]
    resources: [&quot;storageclasses&quot;]
    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;events&quot;]
    verbs: [&quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: run-efs-provisioner
subjects:
  - kind: ServiceAccount
    name: efs-provisioner
    namespace: kube-system
roleRef:
  kind: ClusterRole
  name: efs-provisioner-runner
  apiGroup: rbac.authorization.k8s.io
---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-efs-provisioner
rules:
  - apiGroups: [&quot;&quot;]
    resources: [&quot;endpoints&quot;]
    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]
---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-efs-provisioner
subjects:
  - kind: ServiceAccount
    name: efs-provisioner
    namespace: kube-system
roleRef:
  kind: Role
  name: leader-locking-efs-provisioner
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: efs-provisioner
---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: efs-provisioner
spec:
  replicas: 1
  selector:
    matchLabels:
      app: efs-provisioner
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: efs-provisioner
    spec:
      serviceAccount: efs-provisioner
      containers:
        - name: efs-provisioner
          image: quay.io/external_storage/efs-provisioner:latest
          env:
            - name: FILE_SYSTEM_ID
              valueFrom:
                configMapKeyRef:
                  name: efs-provisioner
                  key: file.system.id
            - name: AWS_REGION
              valueFrom:
                configMapKeyRef:
                  name: efs-provisioner
                  key: aws.region
            - name: DNS_NAME
              valueFrom:
                configMapKeyRef:
                  name: efs-provisioner
                  key: dns.name
                  optional: true
            - name: PROVISIONER_NAME
              valueFrom:
                configMapKeyRef:
                  name: efs-provisioner
                  key: provisioner.name
          volumeMounts:
            - name: pv-volume
              mountPath: /persistentvolumes
      volumes:
        - name: pv-volume
          nfs:
            server: fs-&lt;ID DO SEU EFS&gt;.efs.&lt;REGIAO AWS&gt;.amazonaws.com
            path: /
---
kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: aws-efs
provisioner: nativetrail.io/aws-efs
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: efs-provisioner
data:
  file.system.id: fs-&lt;ID DO SEU EFS&gt;
  aws.region: &lt;REGIAO AWS&gt;
  provisioner.name: nativetrail.io/aws-efs
  dns.name: &quot;&quot;
</code></pre>
<p>Ajuste o ID do seu EFS e região da AWS no manifesto acima, e prestenção, tem que o usar o namespace <strong>kube-system</strong> pois ele é especificado nas <strong>roles</strong> e <strong>serviceaccount</strong>, se instalar o deployment em outro namespace não vai funcionar.</p>
<pre><code>kubectl apply -f instala_efs_provisioner.yaml -n kube-system
    
</code></pre>
<p>Pronto, vamos verificar</p>
<pre><code>kubectl get sc
</code></pre>
<p>Saída esperada</p>
<pre><code>NAME                PROVISIONER              RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
aws-efs             nativetrail.io/aws-efs   Delete          Immediate           false                  43m
aws-ebs (default)   ebs.csi.aws.com          Delete          Immediate           false                  3d16h
</code></pre>
<p>agora vamos testar, crie o manifesto valida-pod-efs.ym com o conteúdo abaixo</p>
<pre><code>---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: valida-aws-efs
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: aws-efs
  resources:
    requests:
      storage: 1Gi
</code></pre>
<p>aplique</p>
<pre><code>kubectl apply -f pod-efs.yaml
</code></pre>
<p>saída</p>
<pre><code>persistentvolumeclaim/valida-aws-efs created
</code></pre>
<p>vamos ver</p>
<pre><code>kubectl get pvc valida-aws-efs
</code></pre>
<p>saída</p>
<pre><code>NAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
valida-aws-efs   Bound    pvc-c524234f-4b07-4248-b328-c6c164dddbc2   1Gi        RWX            aws-efs        3m42s
</code></pre>
<p>agora com mais detalhes</p>
<pre><code>kubectl describe pvc valida-aws-efs
</code></pre>
<p>saída</p>
<pre><code>Name:          valida-aws-efs
Namespace:     default
StorageClass:  aws-efs
Status:        Bound
Volume:        pvc-c524234f-4b07-4248-b328-c6c164dddbc2
Labels:        &lt;none&gt;
Annotations:   pv.kubernetes.io/bind-completed: yes
               pv.kubernetes.io/bound-by-controller: yes
               volume.beta.kubernetes.io/storage-provisioner: nativetrail.io/aws-efs
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      1Gi
Access Modes:  RWX
VolumeMode:    Filesystem
Used By:       &lt;none&gt;
Events:
  Type    Reason                 Age                    From                                                                                   Message
  ----    ------                 ----                   ----                                                                                   -------
  Normal  Provisioning           3m49s                  nativetrail.io/aws-efs_efs-provisioner-644f9f8c8c-n6n48_be97e87c-7e5b-4b42-8756-2adb23a5a105  External provisioner is provisioning volume for claim &quot;default/valida-aws-efs&quot;
  Normal  ProvisioningSucceeded  3m49s                  nativetrail.io/aws-efs_efs-provisioner-644f9f8c8c-n6n48_be97e87c-7e5b-4b42-8756-2adb23a5a105  Successfully provisioned volume pvc-c524234f-4b07-4248-b328-c6c164dddbc2
</code></pre>
<p>Perfeito, tudo funcionando, agora é só usar!</p>
<p>:)</p>
<h3 id="refs">refs</h3>
<ul>
<li><a href="https://github.com/rancher/rke">https://github.com/rancher/rke</a></li>
<li><a href="https://kubernetes.io/pt-br/">https://kubernetes.io/pt-br/</a></li>
<li><a href="https://aws.amazon.com/efs/">https://aws.amazon.com/efs/</a></li>
<li><a href="https://github.com/kubernetes-retired/external-storage/tree/master/aws/efs">https://github.com/kubernetes-retired/external-storage/tree/master/aws/efs</a></li>
<li><a href="https://icicimov.github.io/blog/virtualization/Kubernetes-NFS-shared-storage-in-AWS-with-EFS/">https://icicimov.github.io/blog/virtualization/Kubernetes-NFS-shared-storage-in-AWS-with-EFS/</a></li>
</ul>

            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Centralizando Logs do K8S com o Loki</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/centralizando-logs-do-k8s-com-o-loki/"/>
        <id>https://gutocarvalho.net/centralizando-logs-do-k8s-com-o-loki/</id>
            <category term="Projetos"/>
            <category term="Drops"/>

        <updated>2021-10-22T09:47:50-03:00</updated>
            <summary>
                <![CDATA[
                    Aprenda a instalar o LOKI da GrafanaLabs para centralizar Logs do K8S.
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprenda a instalar o LOKI da GrafanaLabs para centralizar Logs do K8S.</p>
<hr>
<h3 id="o-que-são-drops">O que são drops?</h3>
<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>
<p>Geralmente de algo que eu acabei de fazer.</p>
<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>
<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>
<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>
<h3 id="demanda">Demanda!</h3>
<p>A ideia é instalar um Loki no cluster K8S e começar a centralizar e consumir os logs via dashboard do grafana.</p>
<h3 id="por-que-o-loki">Por que o Loki?</h3>
<p>O Loki é leve – em resumo esse é o maior e melhor motivo para usar ele.</p>
<p>Comparando com outras STACKS, ele nao leva 1/3 ou 2/3 do seu cluster só para centralizar logs.</p>
<p>Você acompanha os logs pelo Grafana Dashboard, simples e direto.</p>
<p>Além disso o projeto tem 14 mil estrelas no GitHub e mais de 400 contribuidores :)</p>
<p>Conheça mais do projeto, dá um chance vai :)</p>
<ul>
<li><a href="https://grafana.com/docs/loki/latest/overview/">https://grafana.com/docs/loki/latest/overview/</a></li>
<li><a href="https://grafana.com/docs/loki/latest/overview/comparisons/">https://grafana.com/docs/loki/latest/overview/comparisons/</a></li>
</ul>
<h3 id="antes-de-começar">Antes de começar</h3>
<p>Estou partindo do pressuposto de que você não tem o grafana instalado!</p>
<p>Precisa ter o Helm instalado e um cluster k8s funcional.</p>
<h3 id="então-comofaz">Então ComoFaz?</h3>
<p>adicione o repositorio e atualize os índices</p>
<pre><code>helm repo add grafana https://grafana.github.io/helm-charts
helm repo update
</code></pre>
<p>instale o loki</p>
<pre><code>helm upgrade --install loki --namespace=loki grafana/loki alertmanager.persistentVolume.enabled=true
</code></pre>
<p>instale o grafana</p>
<pre><code>helm install loki-grafana grafana/grafana
</code></pre>
<p>pegue a senha de admin do grafana</p>
<pre><code>kubectl get secret --namespace &lt;YOUR-NAMESPACE&gt; loki-grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo
</code></pre>
<p>crie um port-forward para acessar o grafana</p>
<pre><code>kubectl port-forward --namespace &lt;YOUR-NAMESPACE&gt; service/loki-grafana 3000:80
</code></pre>
<p>acesse o grafana</p>
<pre><code>http://localhost:3000
</code></pre>
<p>adicione o datasource conforme a doc abaixo</p>
<ul>
<li><a href="https://grafana.com/docs/loki/latest/getting-started/grafana/">https://grafana.com/docs/loki/latest/getting-started/grafana/</a></li>
</ul>
<p>Pronto, divirta-se!</p>
<h3 id="refs">Refs</h3>
<ul>
<li><a href="https://grafana.com/docs/loki/latest/installation/helm/">https://grafana.com/docs/loki/latest/installation/helm/</a></li>
<li><a href="https://grafana.com/go/webinar/loki-getting-started-emea">https://grafana.com/go/webinar/loki-getting-started-emea</a></li>
<li><a href="https://grafana.com/blog/2020/10/28/loki-2.0-released-transform-logs-as-youre-querying-them-and-set-up-alerts-within-loki">https://grafana.com/blog/2020/10/28/loki-2.0-released-transform-logs-as-youre-querying-them-and-set-up-alerts-within-loki</a></li>
</ul>

            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Instalando Rancher 2.6 em HA</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/drops-instalando-rancher-26-em-ha/"/>
        <id>https://gutocarvalho.net/drops-instalando-rancher-26-em-ha/</id>
            <category term="Projetos"/>
            <category term="Drops"/>

        <updated>2021-10-22T09:14:26-03:00</updated>
            <summary>
                <![CDATA[
                    Aprenda a instalar o novíssimo Rancher 2.6 em modo HA. São DUMPs&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprenda a instalar o novíssimo Rancher 2.6 em modo HA.</p>
<hr>
<h3 id="o-que-são-drops">O que são drops?</h3>
<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>
<p>Geralmente de algo que eu acabei de fazer.</p>
<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>
<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>
<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>
<h2 id="demanda">Demanda!</h2>
<p>A ideia é instalar um Rancher em HA, cluster de 3 nodes, usando instâncias AWS EC2.</p>
<h2 id="comofaz">ComoFaz?</h2>
<h3 id="antes-de-começar">antes de começar</h3>
<p>Confere aí :)</p>
<ol>
<li>Tenha o Kubectl instalado</li>
<li>Tenha o RKE instalado</li>
<li>Tenha o Helm instalado</li>
<li>Tenha Conta na AWS</li>
<li>Internet é de bom tom :)</li>
</ol>
<h3 id="instâncias-ec2">instâncias ec2</h3>
<p>Vamos lá!</p>
<ol>
<li>crie um chave ssh no ec2</li>
<li>crie 3 instâncias EC2 em sua conta AWS com essa chave ssh</li>
<li>crie 2 target groups rancher-80 e rancher-443 apontando para as máquinas do cluster</li>
<li>crie o load balancer NLB com dois listeners apontando para os target groups rancher-80 e rancher-443</li>
<li>crie uma entrada de dns <strong>rancher.seudominio.tld</strong> apontando para o CNAME do Load Balancer</li>
<li>crie um security group para liberar acesso a porta 80 e 443 as máquinas do cluster</li>
<li>crie um security group para que voce possa instalar o cluster a partir do seu IP via rke (all ports).</li>
</ol>
<h3 id="preparando-instâncias">preparando instâncias</h3>
<p>instale docker nas 3 maquinas</p>
<pre><code>curl https://releases.rancher.com/install-docker/20.10.sh | sh
</code></pre>
<p>habilite e inicie</p>
<pre><code>systemctl enable docker &amp;&amp; systemctl start docker
</code></pre>
<p>coloque o ubuntu no grupo docker</p>
<pre><code>gpasswd -a ubuntu docker
</code></pre>
<h3 id="preparando-e-instalando-o-cluster-da-sua-máquina">preparando e instalando o cluster (da sua máquina)</h3>
<p>criando configuracao</p>
<pre><code>rke config
</code></pre>
<p>ele vai te fazer umas perguntinhas, cadastre apenas 1 node para facilitar, eu usei 1.1.1.1 como exemplo, aponte o local da sua chave ssh, a mesma que usou nos EC2.</p>
<pre><code>[+] Cluster Level SSH Private Key Path [~/.ssh/id_rsa]:
[+] Number of Hosts [1]:
[+] SSH Address of host (1) [none]: 1.1.1.1
[+] SSH Port of host (1) [22]:
[+] SSH Private Key Path of host (1.1.1.1) [none]:
[-] You have entered empty SSH key path, trying fetch from SSH key parameter
[+] SSH Private Key of host (1.1.1.1) [none]:
[-] You have entered empty SSH key, defaulting to cluster level SSH key: ~/.ssh/id_rsa
[+] SSH User of host (1.1.1.1) [ubuntu]:
[+] Is host (1.1.1.1) a Control Plane host (y/n)? [y]: y
[+] Is host (1.1.1.1) a Worker host (y/n)? [n]: y
[+] Is host (1.1.1.1) an etcd host (y/n)? [n]: y
[+] Override Hostname of host (1.1.1.1) [none]:
[+] Internal IP of host (1.1.1.1) [none]:
[+] Docker socket path on host (1.1.1.1) [/var/run/docker.sock]:
[+] Network Plugin Type (flannel, calico, weave, canal, aci) [canal]:
[+] Authentication Strategy [x509]:
[+] Authorization Mode (rbac, none) [rbac]:
[+] Kubernetes Docker image [rancher/hyperkube:v1.21.5-rancher1]:
[+] Cluster domain [cluster.local]:
[+] Service Cluster IP Range [10.43.0.0/16]:
[+] Enable PodSecurityPolicy [n]:
[+] Cluster Network CIDR [10.42.0.0/16]:
[+] Cluster DNS Service IP [10.43.0.10]:
[+] Add addon manifest URLs or YAML files [no]:
</code></pre>
<p>abra o arquivo e coloque os demais nodos, não se esqueça de cadastrar o ip privado também, depois que finalizar com os nodos, personalize o que for necessário para seu ambiente k8s, o rke é beeem flexível quanto a isso, além de ser o instalador de k8s mais fácil que eu conheço.</p>
<pre><code>nodes:
- address: 1.1.1.1
  port: &quot;22&quot;
  internal_address: &quot;172.31.1.1&quot;
  role:
  - controlplane
  - worker
  - etcd
  hostname_override: &quot;rancher_a&quot;
  user: ubuntu
  docker_socket: /var/run/docker.sock
  ssh_key: &quot;&quot;
  ssh_key_path: ~/.ssh/id_rsa
  ssh_cert: &quot;&quot;
  ssh_cert_path: &quot;&quot;
  labels: {}
  taints: []
- address: 2.2.2.2
  port: &quot;22&quot;
  internal_address: &quot;172.31.1.2&quot;
  role:
  - controlplane
  - worker
  - etcd
  hostname_override: &quot;rancher_b&quot;
  user: ubuntu
  docker_socket: /var/run/docker.sock
  ssh_key: &quot;&quot;
  ssh_key_path: ~/.ssh/id_rsa
  ssh_cert: &quot;&quot;
  ssh_cert_path: &quot;&quot;
  labels: {}
  taints: []
- address: 3.3.3.3
  port: &quot;22&quot;
  internal_address: &quot;172.31.1.3&quot;
  role:
  - controlplane
  - worker
  - etcd
  hostname_override: &quot;rancher_c&quot;
  user: ubuntu
  docker_socket: /var/run/docker.sock
  ssh_key: &quot;&quot;
  ssh_key_path: ~/.ssh/id_rsa
  ssh_cert: &quot;&quot;
  ssh_cert_path: &quot;&quot;
  labels: {}
  taints: []
services:
  etcd:
    image: &quot;&quot;
    extra_args: {}
    extra_binds: []
    extra_env: []
    win_extra_args: {}
    win_extra_binds: []
    win_extra_env: []
    external_urls: []
    ca_cert: &quot;&quot;
    cert: &quot;&quot;
    key: &quot;&quot;
    path: &quot;&quot;
    uid: 0
    gid: 0
    snapshot: null
    retention: &quot;&quot;
    creation: &quot;&quot;
    backup_config: null
  kube-api:
    image: &quot;&quot;
    extra_args: {}
    extra_binds: []
    extra_env: []
    win_extra_args: {}
    win_extra_binds: []
    win_extra_env: []
    service_cluster_ip_range: 10.43.0.0/16
    service_node_port_range: &quot;&quot;
    pod_security_policy: false
    always_pull_images: false
    secrets_encryption_config: null
    audit_log: null
    admission_configuration: null
    event_rate_limit: null
  kube-controller:
    image: &quot;&quot;
    extra_args: {}
    extra_binds: []
    extra_env: []
    win_extra_args: {}
    win_extra_binds: []
    win_extra_env: []
    cluster_cidr: 10.42.0.0/16
    service_cluster_ip_range: 10.43.0.0/16
  scheduler:
    image: &quot;&quot;
    extra_args: {}
    extra_binds: []
    extra_env: []
    win_extra_args: {}
    win_extra_binds: []
    win_extra_env: []
  kubelet:
    image: &quot;&quot;
    extra_args: {}
    extra_binds: []
    extra_env: []
    win_extra_args: {}
    win_extra_binds: []
    win_extra_env: []
    cluster_domain: cluster.local
    infra_container_image: &quot;&quot;
    cluster_dns_server: 10.43.0.10
    fail_swap_on: false
    generate_serving_certificate: false
  kubeproxy:
    image: &quot;&quot;
    extra_args: {}
    extra_binds: []
    extra_env: []
    win_extra_args: {}
    win_extra_binds: []
    win_extra_env: []
network:
  plugin: canal
  options: {}
  mtu: 0
  node_selector: {}
  update_strategy: null
  tolerations: []
authentication:
  strategy: x509
  sans: []
  webhook: null
addons: &quot;&quot;
addons_include: []
system_images:
  etcd: rancher/mirrored-coreos-etcd:v3.4.16-rancher1
  alpine: rancher/rke-tools:v0.1.78
  nginx_proxy: rancher/rke-tools:v0.1.78
  cert_downloader: rancher/rke-tools:v0.1.78
  kubernetes_services_sidecar: rancher/rke-tools:v0.1.78
  kubedns: rancher/mirrored-k8s-dns-kube-dns:1.17.4
  dnsmasq: rancher/mirrored-k8s-dns-dnsmasq-nanny:1.17.4
  kubedns_sidecar: rancher/mirrored-k8s-dns-sidecar:1.17.4
  kubedns_autoscaler: rancher/mirrored-cluster-proportional-autoscaler:1.8.3
  coredns: rancher/mirrored-coredns-coredns:1.8.4
  coredns_autoscaler: rancher/mirrored-cluster-proportional-autoscaler:1.8.3
  nodelocal: rancher/mirrored-k8s-dns-node-cache:1.18.0
  kubernetes: rancher/hyperkube:v1.21.5-rancher1
  flannel: rancher/mirrored-coreos-flannel:v0.14.0
  flannel_cni: rancher/flannel-cni:v0.3.0-rancher6
  calico_node: rancher/mirrored-calico-node:v3.19.2
  calico_cni: rancher/mirrored-calico-cni:v3.19.2
  calico_controllers: rancher/mirrored-calico-kube-controllers:v3.19.2
  calico_ctl: rancher/mirrored-calico-ctl:v3.19.2
  calico_flexvol: rancher/mirrored-calico-pod2daemon-flexvol:v3.19.2
  canal_node: rancher/mirrored-calico-node:v3.19.2
  canal_cni: rancher/mirrored-calico-cni:v3.19.2
  canal_controllers: rancher/mirrored-calico-kube-controllers:v3.19.2
  canal_flannel: rancher/mirrored-coreos-flannel:v0.14.0
  canal_flexvol: rancher/mirrored-calico-pod2daemon-flexvol:v3.19.2
  weave_node: weaveworks/weave-kube:2.8.1
  weave_cni: weaveworks/weave-npc:2.8.1
  pod_infra_container: rancher/mirrored-pause:3.4.1
  ingress: rancher/nginx-ingress-controller:nginx-0.48.1-rancher1
  ingress_backend: rancher/mirrored-nginx-ingress-controller-defaultbackend:1.5-rancher1
  ingress_webhook: rancher/mirrored-jettech-kube-webhook-certgen:v1.5.1
  metrics_server: rancher/mirrored-metrics-server:v0.5.0
  windows_pod_infra_container: rancher/kubelet-pause:v0.1.6
  aci_cni_deploy_container: noiro/cnideploy:5.1.1.0.1ae238a
  aci_host_container: noiro/aci-containers-host:5.1.1.0.1ae238a
  aci_opflex_container: noiro/opflex:5.1.1.0.1ae238a
  aci_mcast_container: noiro/opflex:5.1.1.0.1ae238a
  aci_ovs_container: noiro/openvswitch:5.1.1.0.1ae238a
  aci_controller_container: noiro/aci-containers-controller:5.1.1.0.1ae238a
  aci_gbp_server_container: noiro/gbp-server:5.1.1.0.1ae238a
  aci_opflex_server_container: noiro/opflex-server:5.1.1.0.1ae238a
ssh_key_path: ~/.ssh/id_rsa
ssh_cert_path: &quot;&quot;
ssh_agent_auth: false
authorization:
  mode: rbac
  options: {}
ignore_docker_version: null
enable_cri_dockerd: null
kubernetes_version: &quot;&quot;
private_registries: []
ingress:
  provider: &quot;&quot;
  options: {}
  node_selector: {}
  extra_args: {}
  dns_policy: &quot;&quot;
  extra_envs: []
  extra_volumes: []
  extra_volume_mounts: []
  update_strategy: null
  http_port: 0
  https_port: 0
  network_mode: &quot;&quot;
  tolerations: []
  default_backend: null
  default_http_backend_priority_class_name: &quot;&quot;
  nginx_ingress_controller_priority_class_name: &quot;&quot;
cluster_name: &quot;&quot;
cloud_provider:
  name: &quot;&quot;
prefix_path: &quot;&quot;
win_prefix_path: &quot;&quot;
addon_job_timeout: 0
bastion_host:
  address: &quot;&quot;
  port: &quot;&quot;
  user: &quot;&quot;
  ssh_key: &quot;&quot;
  ssh_key_path: &quot;&quot;
  ssh_cert: &quot;&quot;
  ssh_cert_path: &quot;&quot;
  ignore_proxy_env_vars: false
monitoring:
  provider: &quot;&quot;
  options: {}
  node_selector: {}
  update_strategy: null
  replicas: null
  tolerations: []
  metrics_server_priority_class_name: &quot;&quot;
restore:
  restore: false
  snapshot_name: &quot;&quot;
rotate_encryption_key: false
dns: null
</code></pre>
<p>depois de cadastrar os nodos, vamos começar o provisionamento</p>
<pre><code>rke up —config cluster.yaml
</code></pre>
<p>após instalar verá a seguinte mensagem ( se tudo der certo )</p>
<pre><code>INFO[0255] Finished building Kubernetes cluster successfully
</code></pre>
<p>configure o kubectl</p>
<pre><code>export KUBECONFIG=kube_config_cluster.yml
</code></pre>
<p>verifique se o cluster está funcionando</p>
<pre><code>kubctl get nodes
</code></pre>
<p>saída exemplo</p>
<pre><code>NAME             STATUS   ROLES                      AGE   VERSION
54.225.184.xxx   Ready    controlplane,etcd,worker   12m   v1.21.5
54.243.65.xxx    Ready    controlplane,etcd,worker   12m   v1.21.5
72.44.32.xxx     Ready    controlplane,etcd,worker   12m   v1.21.5
</code></pre>
<p>cluster instalado, agora verifique a saúde de seu cluster</p>
<pre><code>kubectl get pods --all-namespaces
</code></pre>
<p>saída exemplo</p>
<pre><code>NAMESPACE       NAME                                       READY   STATUS      RESTARTS   AGE
ingress-nginx   default-http-backend-6977475d9b-z64cj      1/1     Running     0          17m
ingress-nginx   nginx-ingress-controller-h4c67             1/1     Running     0          17m
ingress-nginx   nginx-ingress-controller-kjd8r             1/1     Running     0          17m
ingress-nginx   nginx-ingress-controller-q4lp2             1/1     Running     0          17m
kube-system     calico-kube-controllers-7d5d95c8c9-mcfj6   1/1     Running     0          18m
kube-system     canal-lsbkv                                2/2     Running     0          18m
kube-system     canal-lwtq9                                2/2     Running     0          18m
kube-system     canal-wm7c8                                2/2     Running     0          18m
kube-system     coredns-55b58f978-jnfsq                    1/1     Running     0          17m
kube-system     coredns-55b58f978-wr4w7                    1/1     Running     0          18m
kube-system     coredns-autoscaler-76f8869cc9-lz44p        1/1     Running     0          18m
kube-system     metrics-server-55fdd84cd4-rjk7w            1/1     Running     0          18m
kube-system     rke-coredns-addon-deploy-job-th472         0/1     Completed   0          18m
kube-system     rke-ingress-controller-deploy-job-59cm4    0/1     Completed   0          17m
kube-system     rke-metrics-addon-deploy-job-94b8t         0/1     Completed   0          18m
kube-system     rke-network-plugin-deploy-job-q5nts        0/1     Completed   0          18m
</code></pre>
<p>aparentemente tudo bem :)</p>
<h3 id="preparando-e-instalando-o-cert-manager-neste-cluster-sua-máquina">preparando e instalando o cert-manager neste cluster (sua máquina)</h3>
<p>instale os crds do cert-manager</p>
<pre><code>kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.5.1/cert-manager.crds.yaml
</code></pre>
<p>adicione o repo e atualize o índices</p>
<pre><code>helm repo add jetstack https://charts.jetstack.io. 
helm repo update
</code></pre>
<p>crie o namespace</p>
<pre><code>kubectl create namespace cert-manager
</code></pre>
<p>instale o cert-mamanger</p>
<pre><code>helm install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --version v1.5.1
</code></pre>
<p>crie o cluster issuer, sem isso ele não gera os certs via lets</p>
<pre><code>apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
  namespace: cert-manager
spec:
  acme:
    # The ACME server URL
    server: https://acme-v02.api.letsencrypt.org/directory
    # Email address used for ACME registration
    email: certmanager@nativetrail.io
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-prod
    # Enable the HTTP-01 challenge provider
    solvers:
    - http01:
        ingress:
          class: nginx
</code></pre>
<p>aplique o issuer</p>
<pre><code>kubectl apply -f issuer.yml
</code></pre>
<p>saída esperada</p>
<pre><code> clusterissuer.cert-manager.io/letsencrypt-prod created
</code></pre>
<p>verifique se está ok</p>
<pre><code>kubectl get clusterissuer 
</code></pre>
<p>saída esperada</p>
<pre><code>NAME               READY   AGE
letsencrypt-prod   True    48s
</code></pre>
<p>se estiver mostrando “True” deu certo!</p>
<h3 id="preparando-e-instalando-o-rancher-neste-cluster-na-sua-máquina">preparando e instalando o rancher neste cluster (na sua máquina)</h3>
<p>adicione o repo e atualize os índices</p>
<pre><code>helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
helm repo update
</code></pre>
<p>crie o namespace cattle-system</p>
<pre><code>kubectl create namespace cattle-system
</code></pre>
<p>instale o rancher</p>
<pre><code>helm install rancher rancher-latest/rancher \
  --namespace cattle-system \
  --set hostname=kloud.gr1d.io \
  --set replicas=3 \
  --set ingress.tls.source=letsEncrypt \
  --set letsEncrypt.email=certmanager@nativetrail.io
</code></pre>
<p>verifique</p>
<pre><code>kubectl get pods -n cattle-system
</code></pre>
<p>saída esperada, estará criando na primeira vez que rodar o comando</p>
<pre><code>NAME                       READY   STATUS              RESTARTS   AGE
rancher-58b56d54df-7mv7d   0/1     ContainerCreating   0          29s
rancher-58b56d54df-csmpl   0/1     ContainerCreating   0          29s
rancher-58b56d54df-pkpz6   0/1     ContainerCreating   0          29s
</code></pre>
<p>aguarde e verifique novamente, use o mesmo comando</p>
<pre><code>kubectl get pods -n cattle-system
</code></pre>
<p>saída</p>
<pre><code>NAME                       READY   STATUS    RESTARTS   AGE
rancher-58b56d54df-7mv7d   0/1     Running   0          41s
rancher-58b56d54df-csmpl   0/1     Running   0          41s
rancher-58b56d54df-pkpz6   0/1     Running   0          41s
</code></pre>
<p>rancher instalado e rodando!</p>
<h3 id="pós-instalação">pós instalação</h3>
<p>observe a saída do comando helm, ele vai te dizer como pegar a senha gerada para o primeiro acesso, depois disso, acesse o rancher via web através da URL definida e siga as os procedimentos para trocar a senha e iniciar o uso do seu rancher.</p>
<h3 id="refs">refs</h3>
<ul>
<li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/">https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/</a></li>
<li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/k8s-tutorials/infrastructure-tutorials/infra-for-ha/">https://rancher.com/docs/rancher/v2.6/en/installation/resources/k8s-tutorials/infrastructure-tutorials/infra-for-ha/</a></li>
</ul>
<p>:)</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>Ferramentas APM open source Self-Hosted</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/ferramentas-open-source-apm/"/>
        <id>https://gutocarvalho.net/ferramentas-open-source-apm/</id>
            <category term="Projetos"/>

        <updated>2021-10-17T16:34:29-03:00</updated>
            <summary>
                <![CDATA[
                    Conheça algumas ferramentas open source para APM para seus projetos Estude e&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Conheça algumas ferramentas open source para APM para seus projetos</p>
<hr>
<p>Estude e avalie essas boas ferramentas que você pode usar em seu projeto e infraestrutura.</p>
<h2 id="apache-skywalking">Apache Skywalking</h2>
<p>Site do projeto: <a href="https://skywalking.apache.org/">https://skywalking.apache.org/</a></p>
<p>GitHub do projeto: 14.7k stars e 250+ contributors</p>
<p>Recomendado para APPs rodando em Cloud e API.</p>
<p>Se você está imerso no universo de API, microserviços, kubernetes e cloud native esse é o projeto para você, ele foi desenhado para Cloud e API sendo hoje um dos maiores, mais respeitados e ativos do GitHub.</p>
<p>Há quem diga que é o melhor nesse segmento hoje.</p>
<h2 id="pinpoint">PinPoint</h2>
<p>Site do projeto: <a href="https://github.com/naver/pinpoint">https://github.com/naver/pinpoint</a></p>
<p>GitHub 10.8k stars e 90+ contributors</p>
<p>Acho que o PinPoint é o preferido da galera de JAVA em 2021, é bem conhecido e vastamente utilizado.</p>
<p>Recomendado para APPs JAVA ou Python</p>
<p>Baseado no Google’s Dapper.</p>
<h2 id="stagemonitor">StageMonitor</h2>
<p>Site do projeto <a href="https://www.stagemonitor.org">https://www.stagemonitor.org</a></p>
<p>GitHub 1.6k stars e 24+ contributors</p>
<p>Recomendado para JAVA, tem compatibilidade e integração com OpenTracing.</p>
<h2 id="scouter">Scouter</h2>
<p>Site do projeto <a href="https://github.com/scouter-project/scouter">https://github.com/scouter-project/scouter</a></p>
<p>GitHub 1.8k starts e 40+ contributors.</p>
<p>Inspirado no New Relic e APP Dynamics, é uma aplicação modular e bastante extensível.</p>
<p>Oferece interações nativas com Telegraf e Zipkin.</p>
<p>Tem agente nativo para java, linux, unix e até windows.</p>
<p>Monitora nativamente (usando telegraph)</p>
<ul>
<li>Redis</li>
<li>Nginx</li>
<li>Apache HTTPd</li>
<li>HAProxy</li>
<li>Kafka</li>
<li>MySQL</li>
<li>MongoDB</li>
<li>RabbitMQ</li>
<li>ElasticSearch</li>
<li>Kubernetes</li>
<li>Mesos</li>
</ul>
<p>Instrumenta nativamente:</p>
<ul>
<li>C#</li>
<li>GO</li>
<li>Java</li>
<li>JavaScript</li>
<li>Ruby</li>
<li>Scala</li>
<li>PHP</li>
</ul>
<p>Instrumentação extendida via código da comunidade</p>
<ul>
<li>C++</li>
<li>Python</li>
<li>Clojure</li>
<li>Elixir</li>
<li>Lua</li>
</ul>
<p>Veja dados completos da instrumentação</p>
<ul>
<li><a href="https://zipkin.io/pages/tracers_instrumentation.html">https://zipkin.io/pages/tracers_instrumentation.html</a> </li>
</ul>
<h2 id="app-metrics">APP Metrics</h2>
<p>Site do projeto <a href="https://www.app-metrics.io/">https://www.app-metrics.io/</a></p>
<p>GitHub 2k starts e 40+ contributors</p>
<p>Recomendado para APPs .Net.</p>
<p>Se o seu negócio é .NET o APP Metrics é a ferramenta pra você e seu time.</p>
<h2 id="inspectit-ocelot">InspectIT Ocelot</h2>
<p>Site do projeto: <a href="https://github.com/inspectIT/inspectit-ocelot">https://github.com/inspectIT/inspectit-ocelot</a></p>
<p>GitHub 158 starts e 25+ contributors</p>
<p>Esse é um projeto novo, o caçula da turma, mas tem muito potencial.</p>
<p>Ele tem uma pegada na fácil configuração, aliás zero configuração e uma boa oferta nativa de métricas.</p>
<p>E isso, bons estudos!</p>
<p>[s]</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Fazer Port Forward no K8S é fácil :)</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/k8s-port-forward-facil/"/>
        <id>https://gutocarvalho.net/k8s-port-forward-facil/</id>
            <category term="K8S"/>
            <category term="Drops"/>

        <updated>2021-11-04T09:51:39-03:00</updated>
            <summary>
                <![CDATA[
                    Aprenda a se conectar em um serviço K8S sem exposição! São DUMPs&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprenda a se conectar em um serviço K8S sem exposição!</p>
<hr>
<h3 id="o-que-são-drops">O que são drops?</h3>
<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>
<p>Geralmente de algo que eu acabei de fazer.</p>
<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>
<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>
<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>
<h3 id="demanda">Demanda!</h3>
<p>Preciso me conectar em um Mongo no cluster sem expor ele para o mundo.</p>
<h3 id="comofaz">ComoFaz?</h3>
<p>Vamos usar o port-forward, veja como a sintaxe é simples</p>
<pre><code>kubectl port-forward nome_do_pod porta_local:portal_cluster -n seu_namespace
</code></pre>
<p>Exemplo!</p>
<pre><code>kubectl port-forward mongodb-replicaset-0 28015:27017 -n seu_namespace
</code></pre>
<p>E como eu acho a porta certa</p>
<pre><code>kubectl get pod mongodb-replicaset-0 --template=&#39;{{(index (index .spec.containers 0).ports 0).containerPort}}{{&quot;\n&quot;}}&#39; -n seu_namespace
</code></pre>
<p>Prontinho!</p>
<h3 id="refs">Refs</h3>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/">https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/</a></li>
</ul>

            ]]>
        </content>
    </entry>
    <entry>
        <title>DROPS: Baixando imagens de ECR Privado no K8S</title>
        <author>
            <name>Guto Carvalho</name>
        </author>
        <link href="https://gutocarvalho.net/baixando-imagens-de-ecr-privado-no-k8s/"/>
        <id>https://gutocarvalho.net/baixando-imagens-de-ecr-privado-no-k8s/</id>
            <category term="K8S"/>
            <category term="Drops"/>

        <updated>2021-10-15T05:55:59-03:00</updated>
            <summary>
                <![CDATA[
                    Aprenda a pegar imagens de registry ECR privado em seu cluster K8S.
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Aprenda a pegar imagens de registry ECR privado em seu cluster K8S.</p>
<hr>
<h3 id="o-que-são-drops">O que são drops?</h3>
<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>
<p>Geralmente de algo que eu acabei de fazer.</p>
<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>
<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>
<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>
<h3 id="demanda">Demanda!</h3>
<p>Precisamos cadastrar um secret para pegar imagens de um ECR privado</p>
<h3 id="comofaz">ComoFaz?</h3>
<p>Primeiro vamos gerar o TOKEN, você precisa do AWS CLI para isso,</p>
<pre><code>aws configure
</code></pre>
<p>depois de configurado gere o TOKEN</p>
<pre><code>aws ecr get-login-password --region us-east-1
</code></pre>
<p>agora vamos no K8S criar o secret</p>
<pre><code>kubectl create secret docker-registry ecr-nativetrail \
  --docker-server=ID.dkr.ecr.us-east-1.amazonaws.com/ \
  --docker-username=AWS \
  --docker-password=SEU_TOKEN_GERADO_VIA_AWS_CLI \
  --namespace=SEU_NAMESPACE
</code></pre>
<p>verifique</p>
<pre><code>kubectl get secrets -n SEU_NAMESPACE|grep ecr
</code></pre>
<p>saída</p>
<pre><code>ecr-nativetrail kubernetes.io/dockerconfigjson        1      15h
</code></pre>
<p>Nao se esqueça de setar o secret no seu manifesto de deployment, dentro de “spec” </p>
<pre><code>      spec:
        imagePullSecrets:
        - name: ecr-nativetrail
</code></pre>
<p>Exemplo</p>
<pre><code>  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: app-example
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: app-example
    template:
      metadata:
        labels:
          app: nativetrail
      spec:
        imagePullSecrets:
        - name: ecr-nativetrail
        containers:
        - name: app-examp;e
          image:  ID.dkr.ecr.us-east-1.amazonaws.com/app:latest
</code></pre>
<p>Prontinho!</p>

            ]]>
        </content>
    </entry>
</feed>
