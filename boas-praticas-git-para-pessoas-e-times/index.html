<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Boas pr√°ticas GIT para pessoas e times - Guto@Site</title><meta name="description" content="30 dicas especiais para Cloud Engineers. Para que seus commits n√£o sejam&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://gutocarvalho.net/boas-praticas-git-para-pessoas-e-times/"><link rel="amphtml" href="https://gutocarvalho.net/amp/boas-praticas-git-para-pessoas-e-times/"><link rel="alternate" type="application/atom+xml" href="https://gutocarvalho.net/feed.xml"><link rel="alternate" type="application/json" href="https://gutocarvalho.net/feed.json"><meta property="og:title" content="Boas pr√°ticas GIT para pessoas e times"><meta property="og:site_name" content="Guto@Site"><meta property="og:description" content="30 dicas especiais para Cloud Engineers. Para que seus commits n√£o sejam&hellip;"><meta property="og:url" content="https://gutocarvalho.net/boas-praticas-git-para-pessoas-e-times/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@gutocarvalho"><meta name="twitter:title" content="Boas pr√°ticas GIT para pessoas e times"><meta name="twitter:description" content="30 dicas especiais para Cloud Engineers. Para que seus commits n√£o sejam&hellip;"><link rel="preload" href="https://gutocarvalho.net/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://gutocarvalho.net/assets/css/style.css?v=9c83ab3077aef3e5c6cca7d59d603ab9"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://gutocarvalho.net/boas-praticas-git-para-pessoas-e-times/"},"headline":"Boas pr√°ticas GIT para pessoas e times","datePublished":"2022-02-11T09:35","dateModified":"2022-02-16T17:17","description":"30 dicas especiais para Cloud Engineers. Para que seus commits n√£o sejam&hellip;","author":{"@type":"Person","name":"Guto Carvalho","url":"https://gutocarvalho.net/authors/gutocarvalho/"},"publisher":{"@type":"Organization","name":"Guto Carvalho"}}</script></head><body><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://gutocarvalho.net/quem-sou/" target="_self">Me conhe√ßa</a></li><li class="has-submenu"><span>Resume</span><ul class="navbar__submenu"><li><a href="https://resume.gutocarvalho.net" target="_self">ENGLISH</a></li><li><a href="https://curriculo.gutocarvalho.net" target="_self">PORTUGUESE</a></li></ul></li><li class="has-submenu"><span>Posts</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/" target="_self">BLOG</a></li><li><a href="https://twitter.com/gutocarvalho" target="_self">TWITTER</a></li></ul></li><li class="has-submenu"><span>Eu recomendo</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/comunidades/" target="_self">COMUNIDADES</a></li><li><a href="https://gutocarvalho.net/siga-o-pessoal-do-bem/" target="_self">PESSOAS</a></li><li><a href="https://gutocarvalho.net/ferramentas-interessantes-para-k8s/" target="_self">K8S TOOLS</a></li><li><a href="https://gutocarvalho.net/sites-interessantes-para-conhecer/" target="_self">TECH SITES</a></li></ul></li><li class="has-submenu"><span>Opini√£o</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/etiqueta-do-trabalho-remoto/" target="_self">ETIQUETA NO JOB REMOTO</a></li><li><a href="https://gutocarvalho.net/ti-remota-em-2022-entenda/" target="_self">ENTENDA O JOB REMOTO EM 22</a></li><li><a href="https://gutocarvalho.net/trinta-percepcoes-sobre-ti-em-2022/" target="_self">30 PERCEPCOES SOBRE TI EM 22</a></li><li><a href="https://gutocarvalho.net/quanto-eu-devo-cobrar-a-hora-de-projetos/" target="_self">VALOR HORA DE PROJETOS</a></li><li><a href="https://gutocarvalho.net/quanto-deveria-ganhar-um-cloud-engineer/" target="_self">SALARIO CLOUD ENGINEER</a></li></ul></li><li class="has-submenu"><span>TECH</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/tags/tips/" target="_self">DROPS</a></li><li><a href="https://gutocarvalho.net/tags/projetos/" target="_self">PROJETOS</a></li><li><a href="https://gutocarvalho.net/tags/mindnotes/" target="_self">MIND NOTES</a></li><li><a href="https://gutocarvalho.net/tags/mente/" target="_self">FALAGUTERA</a></li><li><a href="https://gutocarvalho.net/tags/k8s/" target="_self">K8S</a></li></ul></li><li class="has-submenu"><span>Vitae</span><ul class="navbar__submenu"><li><a href="https://gutocarvalho.net/tags/poesia/" target="_self">POESIA</a></li></ul></li><li><a href="https://gutocarvalho.net/archives/" target="_self">ARCHIVED SITES</a></li><li><a href="https://nativetrail.io" target="_self">NativeTrail</a></li><li><a href="https://www.google.com/search?q&#x3D;site%3Agutocarvalho.net" target="_blank">Busca</a></li><li><a href="https://gutocarvalho.net/contato/" target="_self">Contato</a></li></ul></nav><div class="content"><header class="top"><div class="top__item"><a class="logo" href="https://gutocarvalho.net/">Guto@Site</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main"><article class="post"><div class="main__left"><figure class="hero"><img src="https://gutocarvalho.net/media/website/guto_2022_austin.jpg" srcset="https://gutocarvalho.net/media/website/responsive/guto_2022_austin-xs.jpg 300w, https://gutocarvalho.net/media/website/responsive/guto_2022_austin-sm.jpg 480w, https://gutocarvalho.net/media/website/responsive/guto_2022_austin-md.jpg 768w, https://gutocarvalho.net/media/website/responsive/guto_2022_austin-lg.jpg 1024w, https://gutocarvalho.net/media/website/responsive/guto_2022_austin-xl.jpg 1280w, https://gutocarvalho.net/media/website/responsive/guto_2022_austin-2xl.jpg 1600w" sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" loading="eager" width="1024" height="1280" alt="Guto Carvalho # 2022-01-05 @ BSB"><figcaption class="hero__caption">Guto Carvalho # 2022-01-05 @ BSB</figcaption></figure><header><h1>Boas pr√°ticas GIT para pessoas e times</h1><p><time datetime="2022-02-11T09:35">February 11, 2022 </time>by <a href="https://gutocarvalho.net/authors/gutocarvalho/" rel="author" title="Guto Carvalho">Guto Carvalho</a></p></header></div><div class="main__right"><div class="post__entry"><p>30 dicas especiais para Cloud Engineers.</p><h2 id="o-b√°sico">O B√°sico</h2><h3 id="1-configure-corretamente-nome-e-e-mail">1. Configure corretamente nome e e-mail</h3><p>Para que seus commits <strong>n√£o</strong> sejam gravados com autor ‚Äúroot‚Äù e-mail ‚Äúroot@root‚Äù configure esses valores iniciais assim que instalar seu GIT.</p><pre><code>$ git config --global user.name &quot;Nome Sobrenome&quot;
$ git config --global user.email &quot;email@domain.ext&quot;
</code></pre><p>Pode acontecer de ter que mudar de e-mail dependendo do projeto, nesse caso rode isso dentro do diret√≥rio do seu projeto para sobrescrever as configura√ß√µes globais</p><pre><code>$ cd meu_projeto/
$ git config user.name &quot;Nome Sobrenome&quot;
$ git config user.email &quot;email@domain.ext&quot;
</code></pre><h3 id="2-configure-seu-editor-favorito-globalmente">2. Configure seu editor favorito globalmente</h3><p>Eu gosto de usar o VIM</p><pre><code> $ git config --global core.editor vim
</code></pre><h3 id="3-ative-o-autocorrect">3. Ative o autocorrect</h3><p>O autocorrect vai te ajudar nos erros mais comuns, afinal quem nunca digitou git stats o bramch n√©?</p><pre><code>$ git config --global help.autocorrect 10
</code></pre><p>olhe um exemplo quando digitamos BRAMCH ao inv√©s de BRANCH</p><pre><code>$ git bramch
WARNING: You called a Git command named &#39;bramch&#39;, which does not exist.
Continuing in 1.0 seconds, assuming that you meant &#39;branch&#39;.
dev
prod
* main
</code></pre><p>olhe um exemplo quando digitamo STATS ao inv√©s de STATUS</p><pre><code>$ git stats
WARNING: You called a Git command named &#39;stats&#39;, which does not exist.
Continuing in 1.0 seconds, assuming that you meant &#39;status&#39;.
On branch gh-pages
nothing to commit, working tree clean
</code></pre><p>√â bastante √∫til n√£o √©?</p><p>O valor <strong>10</strong> declara 10x10 d√©cimos de segundo, o mesmo que 1 segundo e por a√≠ vai. Caso queira que corrija automaticamente sem aguardar, use o valor 1.</p><pre><code>$ git config --global help.autocorrect 1
</code></pre><p>Dessa forma ele vai digitar o comando para voc√™, veja mais detalhes no link abaixo</p><ul><li><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration#_code_help_autocorrect_code">https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration#_code_help_autocorrect_code</a></li></ul><h4 id="como-desligar-o-autocorrect">como desligar o autocorrect?</h4><pre><code>$ git config --global --unset help.autocorrect
</code></pre><h3 id="4-use-uma-vers√£o-atualizada-do-git">4. Use uma vers√£o atualizada do GIT</h3><p>Normalmente o GIT que vem nas distribui√ß√µes linux √© bem antigo ent√£o √© uma boa ideia atualizar se quer usar recursos mais recentes e vers√µes com mais performance.</p><p>Se estiver no mac o Homebrew pode ajudar.</p><pre><code>$ brew install git
</code></pre><p>Com isso voc√™ vai usar a √∫ltima vers√£o est√°vel.</p><h3 id="5-crie-aliases-para-agilizar-seu-trabalho">5. Crie aliases para agilizar seu trabalho</h3><p>Atalhos para mais produtividade, o Git oferece aliases para que possamos economizar alguns caracteres, veja como usar</p><pre><code>$ git config --global alias.co checkout
$ git co production
Switched to branch &#39;production&#39;
</code></pre><p>outro exemplo</p><pre><code>$ git config --global alias.st status
$ git st
On branch gh-pages
nothing to commit, working tree clean
</code></pre><p>Uma outra forma de criar aliases √© editar seu gitconfig e setar manualmengte</p><pre><code>$ vim ~/.gitconfig
</code></pre><p>Adicione uma sess√£o com essa</p><pre><code>[alias]
    co = checkout
    st = status
</code></pre><p>Simples e r√°pido!</p><h2 id="junte-seu-time-e-defina-os-padr√µes-que-v√£o-usar">Junte seu time e defina os padr√µes que v√£o usar</h2><p>Agora que seu GIT j√° est√° atualizado e configurado vamos definir algumas coisas.</p><h3 id="6-sente-com-seu-time-e-formalize-o-padr√£o-de-versionamento-que-v√£o-seguir">6. Sente com seu time e formalize o padr√£o de versionamento que v√£o seguir</h3><p>Combinar antes √© sai mais barato do que arrumar depois, converse com seu time e defina:</p><ul><li>Conven√ß√µes comuns</li><li>Quais ser√£o e como usar branchs de integra√ß√£o</li><li>Quais ser√£o e como usar branchs de features</li><li>Quais ser√£o e como usar demais branchs</li><li>Padr√£o de nome de branchs para integra√ß√£o<ul><li>feature-xyz, hotfix-xyz, stage, test, prod</li></ul></li><li>Padr√£o esperado para commit, forma, mensagens</li><li>Templates e forma de se fazer merge</li><li>Regras gerais do que se deve ou se deve n√£o fazer</li></ul><p>Eu sugiro que crie um repo git e coloque tudo isso em formato MD, nada melhor do que versionar suas regras :)</p><h2 id="boas-pr√°ticas-com-branchs">Boas pr√°ticas com branchs</h2><h3 id="7-use-e-abuse-de-branchs">7. Use e abuse de branchs</h3><p>O recurso de branch √© fant√°stico, voc√™ pode criar a partir de qualquer uma.</p><p>Dicas principais:</p><ul><li>Evite gravar diretamente na main.</li><li>Sempre trabalhe em uma branch separada</li><li>Integre sua branch quando finalizar seu trabalho</li><li>Apague sua branch depois que tiver terminado</li></ul><p>Exemplo</p><pre><code>$ git branch -u main correcao_criacao_vpc
$ git checkout correcao_criacao_vpc
</code></pre><p>Quando terminar seu ticket, apague a branch</p><pre><code>$ git branch -D correcao_criacao_vpc
</code></pre><h3 id="8-use-branchs-de-integra√ß√£o">8. Use branchs de integra√ß√£o</h3><p>Quando estamos trabalhando com integra√ß√£o cont√≠nua o uso de <strong>branchs</strong> de <strong>integra√ß√£o</strong> √© fundamental, precisamos integrar nosso c√≥digo com o c√≥digo de nossos colegas e rodar os testes na pipeline.</p><p>Geralmente temos uma branch de integra√ß√£o para <strong>desenvolvimento</strong> e depois vamos promovendo esse c√≥digo para outras branchs que v√£o nos ajudar a <strong>fechar a release e publicar</strong>, tudo depende do <strong>git-flow</strong> que seu time acordou e est√° seguindo.</p><h3 id="9-n√£o-escreva-direto-na-branch-main">9. N√£o escreva direto na branch MAIN</h3><p>Evitamos escrever direto na branch <strong>main</strong> pois geralmente √© a √∫ltima vers√£o est√°vel devidamente testada e validada por todos, √© de fato a fonte da verdade, portanto, para colocar c√≥digo l√° devemos sempre passar por diversos testes em sua pipeline e revis√µes de seus colegas.</p><h3 id="10-mantenha-sua-feature-branch-atualizada">10. Mantenha sua feature-branch atualizada</h3><p>Fa√ßa rebases regulares para garantir isso!</p><p>Exemplo de atualiza√ß√£o da branch main localmente e depois rebase</p><pre><code>$ git checkout main
$ git pull
$ git checkout feature-xyz  
$ git rebase main  
</code></pre><p>Exemplo de merge do c√≥digo com a main</p><pre><code>$ git checkout main
$ git pull
$ git merge feature-xyz
</code></pre><p>Hoje em dia eu quase n√£o fa√ßo merge no bra√ßo, geralmente uso MR ou PR, depende da ferramenta que estamos usando.</p><h3 id="11-de-vez-em-quando-recrie-suas-branchs-de-integra√ß√£o">11. De vez em quando recrie suas branchs de integra√ß√£o</h3><p>Isso √© legal de fazer para dar uma limpada na coisa toda e come√ßar novamente.</p><pre><code>$ git checkout main
$ git branch -D devel
$ git branch -u main devel
</code></pre><h3 id="12-limpe-periodicamente-branchs-de-feature">12. Limpe periodicamente branchs de feature</h3><p>O ideal √© sempre apagar suas branchs de feature ou de teste ap√≥s finalizar um ticket.</p><p>Apesar de ser o ideal, nem sempre lembramos, ent√£o de vez em quando √© bom olhar e apagar branchs que n√£o est√£o sendo usadas.</p><p>Pode-se at√© definir um tempo de vida para branchs que n√£o s√£o fixas, e definindo isso podemos at√© criar uma automa√ß√£o para limpar o repo.</p><h2 id="boas-pr√°ticas-com-commit">Boas pr√°ticas com commit</h2><h3 id="13-corrija-as-mensagens-do-seu-commit-se-errar">13. Corrija as mensagens do seu commit se errar</h3><p>Caso perceba algum typo na sua mensagem de commit, use o amend para corrigir</p><pre><code> $ git commit -v --amend
</code></pre><h3 id="14-fa√ßa-commits-pontuais-e-objetivos">14. Fa√ßa commits pontuais e objetivos</h3><p>Evite fazer um commit com dezenas de arquivos, em especial se esses arquivos trazem mais de uma mudan√ßa ou corre√ß√£o. Devemos evitar isso pois fica dif√≠cil rastrear, entender e revisar o que foi feito no commit.</p><p>Prefira fazer commits pequenos e pontuais de algo que est√° terminado, algo que funciona e que n√£o traga muitas altera√ß√µes de uma vez s√≥.</p><h3 id="15-fa√ßa-commits-at√¥micos-quando-poss√≠vel">15. Fa√ßa commits at√¥micos quando poss√≠vel</h3><p>J√° sabemos que commitar poucas altera√ß√µes √© o melhor caminho, mas d√° para ser ainda menor.</p><p>Os commits at√¥micos s√£o aqueles que gravam apenas uma √∫nica mudan√ßa ‚Äì ainda que envolva v√°rios arquivos ‚Äì em um √∫nico commit.</p><p>√â claro que nem sempre d√° para fazer, mas √© uma pr√°tica excelente se conseguir fazer.</p><p>A ideia do commit at√¥mico √© gravar a menor e mais importante melhoria que voce fez no c√≥digo, sendo grande suficiente para adicionar algum valor, contudo, pequena o suficiente para ser gerenciada com flexibilidade.</p><p>Se quiser trabalhar dessa forma tenha em mente duas coisas:</p><ul><li>Trabalhe em uma coisa por vez</li><li>Fa√ßa altera√ß√µes pequenas e pontuais</li></ul><h3 id="16-fa√ßa-commits-regulares-e-frequentes">16. Fa√ßa commits regulares e frequentes</h3><p>N√£o espere demais!</p><p>Algumas pessoas esperam demais at√© gravar alguma altera√ß√£o, √†s vezes ficam ali melhorando algo que j√° est√° funcionando, buscando algum tipo de perfei√ß√£o antes de gravar.</p><p>Deixa eu te dizer uma coisa, o git funciona melhor e te ajuda mais quando voc√™ grava com frequ√™ncia ao inv√©s de esperar muitoooo tempo para gravar sua mudan√ßa.</p><p>Ao gravar com frequ√™ncia voc√™ vai rastrear inclusive como voc√™ foi melhorando aquele c√≥digo ao longo do seu processo e hist√≥rico de desenvolvimento.</p><p>E lembre-se, o GIT s√≥ cuida do seu c√≥digo depois que voc√™ grava, se voc√™ fechar o editor por acidente ou se o editor travar, seu c√≥digo j√° era, contudo, se estiver commitando com frequ√™ncia voc√™ evita isso.</p><h3 id="17-quebre-seu-commit-em-commits-menores">17. Quebre seu commit em commits menores</h3><p>As vezes a gente vai trabalhando e se empolga demais, e com isso acaba fazendo mais de uma altera√ß√£o em um mesmo arquivo, e neste caso, tais altera√ßoes que poderiam ser commitadas de forma separada. Se for esse o caso, o commando abaixo te permite escolher quais mudan√ßas voc√™ deseja commitar em um determinado arquivo.</p><pre><code>$ git add -p &lt;nome_do_arquivo&gt;
</code></pre><p>Assim vamos conseguir commitar pequenas por√ß√µes do arquivo por vez.</p><h3 id="18-n√£o-fa√ßa-commit-de-algo-que-voc√™-n√£o-finalizou">18. N√£o fa√ßa commit de algo que voc√™ n√£o finalizou</h3><p><strong>Nunca</strong>, eu repito, <strong>nunca</strong> grave algo que n√£o est√° funcionando ou que n√£o est√° completo.</p><h3 id="19-teste-seu-c√≥digo-antes-de-gravar">19. Teste seu c√≥digo antes de gravar</h3><p>Essa √© uma das coisas mais b√°sicas que vou falar hoje, mas tem que falar e tem que fazer.</p><p>Caso n√£o saiba, gravar c√≥digo quebrado √© algo bastante inc√¥modo, poder√° irritar seus colegas, podendo em alguns casos chegar a ser considerado uma falta de respeito e falta de profissionalismo.</p><p>Verifique a sintaxe do seu c√≥digo, rode um linter e execute o c√≥digo para ver se o que fez est√° funcionando, seja uma feature, seja um bugfix, seja um hotfix, afinal, se o c√≥digo estiver funcionando e se sua solu√ß√£o resolver o ticket, isso ser√° o melhor dos mundos.</p><p>O git inclusive oferece um sistema de HOOKS que permite por exemplo, executar comandos de checagem antes de de gravar seu c√≥digo, nesse caso estou falando do hook ‚Äúpre-commit‚Äù, veja o link abaixo e leia sobre esse e outros hooks, √© um recurso muito √∫til, acredite.</p><ul><li><a href="https://git-scm.com/docs/githooks">https://git-scm.com/docs/githooks</a></li></ul><h3 id="20-escreva-mensagens-de-commit-claras">20. Escreva mensagens de commit claras</h3><p>As mensagens precisam fazer sentido e ser √∫teis para todos do time.</p><h4 id="201-commitando-em-uma-linha">20.1 Commitando em uma linha</h4><p>A mensagem tem que fazer sentido, ser f√°cil de ler e ser suficiente para entender o que foi feito.</p><h5 id="exemplos">Exemplos</h5><p>Podemos usar conven√ß√µes para mostrar que fizemos uma <strong>corre√ß√£o</strong></p><pre><code>fix: corrige bug quando modulo vai crair a 2o VPC na AWS
</code></pre><p>ou uma <strong>refatora√ß√£o</strong></p><pre><code>refact: refatora c√≥digo que configura IAM para EKS na AWS
</code></pre><p>ou uma <strong>documenta√ß√£o</strong></p><pre><code>doc: adiciona docs para uso do modulo IAM/EKS
</code></pre><p>ou que inserimos <strong>testes</strong></p><pre><code>test: adiciona testes unit√°rios no m√≥dulo
    
</code></pre><p>ou que criamos uma nova <strong>feature</strong></p><pre><code>feat: adiciona recurso para lidar com ALB no EC2/AWS
</code></pre><h5 id="entendendo-a-estrutura">Entendendo a estrutura</h5><p>√â simples</p><pre><code>feat: adiciona fature para recursos ALB no EC2/AWS #220412
^--^  ^-----------------------------------------^
|     |
|     +-&gt; Sum√°rio da sua mudan√ßa
|
+-------&gt; Tipo: docs, feat, fix, refact, ou test.
</code></pre><p>Se voc√™ estiver usando um sistema de tickets junto, adicione o n√∫mero do ticket na mensagem, sistemas como GitLab e GitHub j√° far√£o a associa√ß√£o para voc√™ entre a issue e o commit.</p><p>Evite colocar ponto final na mensagem, afinal √© um t√≠tulo.</p><p>Vale lembrar que voc√™ deve evitar escrever mais de 50 caracteres ou vai quebrar a sa√≠da do ‚Äúgit log‚Äù.</p><h5 id="de-que-modo-escrever-a-mensagem">De que modo escrever a mensagem?</h5><p>Em alguns blogs voc√™s ver√£o pessoas que defendam usar verbos no imperativo ou presente do indicativo, e faz sentido. Em ambos os casos a ideia √© que o commit responda essa pergunta:</p><pre><code>  &quot;Em caso de aplicar esse commit ele...&quot;
</code></pre><p>Resposta</p><pre><code>...altera c√≥digo X
...corrige m√≥dulo Y
...refatora manifesto Z
...cria feature W para m√≥dulo X
</code></pre><p>Eu j√° gosto de usar partic√≠pio do passado, pois foi algo que j√° foi realizado e nem precisa fazer a perguntinha para ver como tem que escrever, neste caso voc√™ pode afirmar ao inv√©s de perguntar, dessa forma:</p><pre><code>&quot;Nesse commit foi...&quot;
</code></pre><p>Resposta</p><pre><code>...alterado c√≥digo X
...corrigido m√≥dulo Y
...refatorado manifesto Z
...criada a feature W para m√≥dulo X
</code></pre><p>Enfim, existem longas threads sobre isso na internet, quase uma guerra santa, contudo, IMHO isso vai depender de cada um, ou da forma como cada time decidiu trabalhar.</p><p>No final o importante √© voc√™ versionar seu c√≥digo e conseguir entender o que fez ali lendo a mensagem de commit :)</p><h4 id="202-usando-o-editor-para-algo-mais-detalhado">20.2 Usando o editor para algo mais detalhado</h4><p>As vezes precisamos escrever um pouco mais, indo al√©m do ‚Äúone line commit‚Äù, especialmente se foi uma corre√ß√£o complexa, se tem alguma pegadinha, ou se for preciso explicar porque voc√™ fez aquilo daquela forma. No caso do trabalho e o dia-a-dia dos Cloud Engineers nem sempre √© necess√°rio, mas se for, veja como fazer.</p><p>Nesse caso, como √© uma mensagem longa, n√£o podemos fazer ‚Äúone line commit‚Äù, temos que ir para o editor.</p><pre><code>$ git commit
</code></pre><p>E escrever a mensagem</p><pre><code>Assunto da mensagem com no m√°ximo 50 caracteres, sem ponto final

Descri√ß√£o em m√∫ltiplas linhas
sobre seu commit. Use at√© 72 caracteres

Outros par√°grafos podem vir ap√≥s inserir 
uma linha em branco
Aqui nao tem mais limite de caracteres

Podemos usar bullets tamb√©m, ajuda a organizar a informa√ß√£o

- Enumerando
- Altera√ß√µes
- Realizadas
- Por
- Este
- Commit

Se existe um ticket coloque 
o n√∫mero dele na mensagem e os tickets relacionados

Esse commit resolve o problema do ticket #2222
E est√° relacionado com o ticket #3333 e #4444
</code></pre><p>√â bem simples!</p><h3 id="21-n√£o-reescreva-o-hist√≥rico-da-branch-principal">21. N√£o reescreva o hist√≥rico da branch principal</h3><p>Se voc√™ j√° gravou o c√≥digo na branch principal, e o c√≥digo alterado j√° est√° dispon√≠vel para outras pessoas verem, recomenda-se n√£o alterar esse hist√≥rico.</p><p>Fazer rebase na MAIN ou qualquer que seja o nome da sua branch upstream, ou mesmo em uma branch de integra√ß√£o pode causar problemas para seus colegas e eles podem ter que lidar com conflitos ou ter que fazer stash e baixar toda a branch novamente. Fora que normalmente altera√ß√µes nessas branchs geralmente acionam gatilhos em ferramentas de CICD, o que pode gerar um deploy com regress√£o.</p><p>Dito isso, muito cuidado com suas branchs, em especial a upstream e as branchs de integra√ß√£o.</p><p>Na sua branch de feature voc√™ faz o que quiser, use o rebase sem problema algum, mas s√≥ nela ok?</p><h2 id="boas-pr√°ticas-com-merge">Boas pr√°ticas com merge</h2><h3 id="22-fa√ßa-squash-antes-de-fazer-um-merge">22. Fa√ßa squash antes de fazer um merge</h3><p>Antes de fazer um merge verifique seu hist√≥rico de commit, veja se √© poss√≠vel melhorar o hist√≥rico, reduzir e juntar algumas coisas, as vezes 20 commits podem ser agrupados em 10, fica mais limpo, organizado e facilitar√° a revis√£o por seus pares.</p><pre><code>$ git rebase -i HEAD~20  # apresenta os √∫ltimos 20 commits para fazer o squash
</code></pre><p>Fa√ßa o squash na sua branch de trabalho antes de mandar o PR/MR e altere apenas os seus commits ok?</p><h3 id="23-use-e-abuse-de-mrs-e-prs-no-github-e-gitlab">23. Use e abuse de MRs e PRs no GitHub e GitLab</h3><p>A vantagem de usar PR ou MR seja no GitLab ou GitHub √© que voc√™ tem facilidades para fazer squash, resolver conflitos, enxergar o que mudou (diff), solicitar revis√£o de pares, receber coment√°rios e ent√£o finalmente fazer o merge. S√£o excelentes recursos e devemos us√°-los pois facilitam nossa vida.</p><h2 id="outras-coisas-interessantes">Outras coisas interessantes</h2><h3 id="24-use-nomes-consistentes-para-seus-remotes">24. Use nomes consistentes para seus remotes</h3><p>Origin √© um nome padr√£o, mas n√£o √© obrigat√≥rio t√°?</p><pre><code>$ git push origin main
</code></pre><p>Podemos mudar esse nome para dar mais contexto e ficar mais claro de qual remote estamos falando</p><pre><code>$ git push gitlab main
$ git push github main
$ git push bitbucket main
$ git push clienteX main
</code></pre><p>Colocar um contexto no nome do remote ajuda bastante, especialmente se tem v√°rios remotes.</p><h3 id="25-prefira-autentica√ß√£o-ssh-ao-inv√©s-de-usersenha">25. Prefira autentica√ß√£o SSH ao inv√©s de user/senha</h3><p>Autentica√ß√£o atrav√©s de chaves √© mais segura, tanto que algumas ferramentas como GitHub desabilitam push em outros m√©todos.</p><h4 id="criando-uma-chave-ssh-segura-ed2559">Criando uma chave ssh segura (ed2559)</h4><p>Como criar um chave segura?</p><pre><code>$ ssh-keygen -o -a 100 -t ed25519 -f ~/.ssh/nome_da_sua_chave -C ‚Äúnome@domain.ext‚Äù
</code></pre><p>Quer saber por que usar o ed25519?</p><p>Basicamente pois √© um algoritmo mais moderno que usa curvas el√≠piticas, mais perform√°tico comparado com outras alternativas.</p><p>Se quiser saber mais mergulhe nesse post!</p><ul><li><a href="https://medium.com/risan/upgrade-your-ssh-key-to-ed25519-c6e8d60d3c54">https://medium.com/risan/upgrade-your-ssh-key-to-ed25519-c6e8d60d3c54</a></li></ul><h4 id="definindo-o-uso-de-chaves-ssh-para-repos-espec√≠ficos">Definindo o uso de chaves ssh para repos espec√≠ficos</h4><p>No meu caso eu trabalho com v√°rias chaves ssh, uma para projetos pessoais, uma para projetos na empresa que trabalho e sempre crio chaves para projetos ou freelas que eu estou fazendo.</p><p>√â sempre bom evitar usar a mesma chave para tudo.</p><p>Mas como organizar isso?</p><p>Simples edite o arquivo ~/.ssh/config e configure a chave para cada server</p><pre><code>Host nativeltrail_gitlab
  Hostname gitlab.nativetrail.io
  User git
  IdentityFile ~/.ssh/id_ed2559_gitlab_nativetrail_key

Host client_x_gitlab
  Hostname gitlab.cliente-x.com
  User git
  IdentityFile ~/.ssh/id_ed2559_gitlab_clientex_key
  
Host gitlab
  Hostname gitlab.com
  User git
  IdentityFile ~/.ssh/id_ed2559_gitlab_key 

Host github
  Hostname github.com
  User git
  IdentityFile ~/.ssh/id_ed2559_github_key  
</code></pre><p>Pronto, diferentes chaves para diferentes servidores e servi√ßos.</p><h3 id="26-use-e-abuse-do-gitignore">26. Use e abuse do .Gitignore</h3><p>O Gitignore √© um arquivo essencial em nosso reposit√≥rio, √© atrav√©s dele que dizemos para o GIT ignorar alguns arquivos e n√£o version√°-los.</p><p>O Github traz uma bela cole√ß√£o de templates para isso, veja no link abaixo:</p><ul><li><a href="https://github.com/github/gitignore">https://github.com/github/gitignore</a></li></ul><h4 id="usando-o-gitignore-local">usando o gitignore local</h4><p>neste caso crie na raiz do diretorio um arquivo com o nome .gitignore e insira o que deseja ignorar.</p><pre><code>_site
_temp
_build
*.zip
*.tar.gz
</code></pre><p>e pronto, seu git vai ignorar esses padroes, saiba mais na documenta√ß√£o:</p><ul><li><a href="https://git-scm.com/docs/gitignore">https://git-scm.com/docs/gitignore</a></li></ul><h4 id="usando-o-gitignore-global">usando o gitignore global</h4><p>Esse arquivo √© global e todos os projetos v√£o ler ele, √© bem √∫til para coisas comuns e para projetos que ainda n√£o tem um .gitignore constru√≠do</p><p>Criando o arquivo</p><pre><code>$ touch ~/caminho/para/seu/global/.gitignore
</code></pre><p>Ativando via CLI</p><pre><code>$ git config --global core.excludesFile ~/caminho/para/seu/global/.gitignore
</code></pre><p>Caso prefira edite seu .gitconfig diretamente e insira a configura√ß√£o</p><pre><code>[core]
  excludesFile = ~/caminho/para/seu/global/.gitignore
</code></pre><p>No mac eu uso esse conte√∫do</p><pre><code># General
.DS_Store
.AppleDouble
.LSOverride

# Icon must end with two \r
Icon

# Thumbnails
._*

# Files that might appear in the root of a volume
.DocumentRevisions-V100
.fseventsd
.Spotlight-V100
.TemporaryItems
.Trashes
.VolumeIcon.icns
.com.apple.timemachine.donotpresent

# Directories potentially created on remote AFP share
.AppleDB
.AppleDesktop
Network Trash Folder
Temporary Items
.apdisk

# Files that might appear on external disks
.Spotlight-V100
.Trashes

# Vscode
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
!.vscode/*.code-snippets

# Local History for Visual Studio Code
.history/

# Built Visual Studio Code Extensions
*.vsix
</code></pre><h3 id="27-use-tags-para-criar-refer√™ncias-no-seu-hist√≥rico">27. Use tags para criar refer√™ncias no seu hist√≥rico</h3><p>Tags que identificam milestones</p><pre><code>$ git tag milestone-id -m
$ git push --tags
</code></pre><p>Tags que identificam um estado</p><pre><code>$ git tag stable -m
$ git push --tags
</code></pre><p>Tags que identificam vers√µes</p><pre><code>$ git tag v1.2.3 -m
$ git push --tags
</code></pre><p>Existem v√°rias formas de usar tags, seu uso facilita a identifica√ß√£o de um momento espec√≠fico em seu hist√≥rico de desenvolvimento, tal como o fechamento de uma release, a conclus√£o de um milestones, a identifi√ß√£o e uma vers√£o, o que possibilita que fa√ßamos clone do c√≥digo naquele momento exato.</p><h3 id="28-se-poss√≠vel-use-versionamento-sem√¢ntico">28. Se poss√≠vel use versionamento sem√¢ntico</h3><p>Caso n√£o conhe√ßa acessa o site <a href="https://semver.org">https://semver.org</a></p><p>O versionamento sem√¢ntico consiste basicamente no uso de tr√™s numeros que podem ser incrementados, como o exemplo abaixo:</p><pre><code>2.3.5
</code></pre><h5 id="major">MAJOR</h5><p>O primeiro n√∫mero √© chamado de <strong>major</strong>, ele deve ser incrementando quando alguma mudan√ßa causa uma quebra de compatilidade de API</p><h5 id="minor">MINOR</h5><p>O segundo n√∫mero √© chamado de <strong>minor</strong>, ele deve ser incrementado quando uma nova funcionalidade √© adicionada, sem quebra de compatibilidade</p><h5 id="patch">PATCH</h5><p>O terceiro n√∫mero √© chamado de <strong>patch,</strong> ele deve ser incrementado quando fazemos algum tipo de corre√ß√£o na vers√£o minor</p><h5 id="buildrelease">BUILD/RELEASE</h5><p>Ao ler o semver.org voc√™ ver√° outras possibilidades de versionar, usando build number e release name, veja alguns exemplos:</p><pre><code>1.0.0-alpha
1.0.0-beta
1.0.0-rc1
1.0.0-rc2
1.0.0+20130313144700
1.0.0-0.3.7
</code></pre><p>O versionamento sem√¢ntico √© bem flex√≠vel e f√°cil de usar, voc√™ vai ver.</p><h4 id="posso-automatizar-o-incremento-de-vers√£o">Posso automatizar o incremento de vers√£o?</h4><p>Como as regras s√£o claras fica f√°cil entender como incrementar a vers√µes manualmente e podemos at√© mesmo automatizar isso em nossa pipeline.</p><h4 id="posso-criar-o-meu-pr√≥prio-m√©todo">Posso criar o meu pr√≥prio m√©todo?</h4><p>Claro, cada time pode definir seu jeito de versionar, mas lembre-se criar um repo onde voc√™ explica isso para todo mundo, em formato MD. :)</p><h3 id="29-cuidado-com-push-usando-force">29. Cuidado com Push usando FORCE</h3><p>Quando voc√™ manda um</p><pre><code>$ git push origin main --force
</code></pre><p>Voc√™ est√° sobrescrevendo tudo que tem no ORIGIN na branch MAIN.</p><p>Todo o cuidado √© pouco, se for fazer avise a turma, pe√ßa permiss√£o e fa√ßa um backup antes.</p><h4 id="quais-problemas-isso-pode-gerar">Quais problemas isso pode gerar?</h4><p>Se algu√©m fez um push e voc√™ n√£o atualizou sua branch local, os commits do coleginha ser√£o perdidos.</p><p>Se algu√©m fez um clone e voc√™ mandou um force removendo v√°rias coisas, no pr√≥ximo pull o coleginha vai lidar com conflitos ou coisas piores, talvez tenha at√© que apagar o repo e baixar novamente.</p><p>Isso pode gerar algumas situa√ß√µes chatas com seu time, tome cuidado, use com cuidado.</p><h3 id="30-aprenda-mais-sobre-o-git-e-pratique">30. Aprenda mais sobre o GIT e pratique</h3><p>Aprender, entender e usar boas pr√°ticas vem com a experi√™ncia do dia a dia, quanto mais ler para conhecer seus recursos, quanto mais usar, mais precisar√° aprender, √© assim que funciona.</p><p>Ent√£o vai l√° e estuda!</p><ul><li><a href="https://git-scm.com/book/en/v2">https://git-scm.com/book/en/v2</a></li></ul><p>Sucesso!</p><h2 id="refs">Refs</h2><ul><li><a href="https://deepsource.io/blog/git-best-practices/">https://deepsource.io/blog/git-best-practices/</a></li><li><a href="https://opensource.com/article/20/7/git-best-practices">https://opensource.com/article/20/7/git-best-practices</a></li><li><a href="https://cbea.ms/git-commit">https://cbea.ms/git-commit</a></li><li><a href="https://github.com/git-tips/tips">https://github.com/git-tips/tips</a></li><li><a href="https://codeburst.io/git-tips-and-tricks-to-improve-your-git-workflow-3f8652fa4a62">https://codeburst.io/git-tips-and-tricks-to-improve-your-git-workflow-3f8652fa4a62</a></li></ul><p>[s]<br>Guto</p><p>Se gostou manda um alo no twitter <a href="https://twitter.com/gutocarvalho">@gutocarvalho</a>.</p><footer><div class="post__tag-share"><ul class="post__tag"><li><a href="https://gutocarvalho.net/tags/tldr/">TLDR</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fgutocarvalho.net%2Fboas-praticas-git-para-pessoas-e-times%2F" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fgutocarvalho.net%2Fboas-praticas-git-para-pessoas-e-times%2F&amp;via=gutocarvalho&amp;text=Boas%20pr%C3%A1ticas%20GIT%20para%20pessoas%20e%20times" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fgutocarvalho.net%2Fboas-praticas-git-para-pessoas-e-times%2F" class="js-share linkedin" aria-label="[MISSING TRANSLATION] Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://api.whatsapp.com/send?text=Boas%20pr%C3%A1ticas%20GIT%20para%20pessoas%20e%20times https%3A%2F%2Fgutocarvalho.net%2Fboas-praticas-git-para-pessoas-e-times%2F" class="js-share whatsapp" title="[MISSING TRANSLATION] Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#whatsapp"/></svg></a></div></div><div class="post__bio"><img src="https://gutocarvalho.net/media/website/guto_22_02.png" loading="lazy" height="false" width="false" alt="Guto Carvalho"><h3><a href="https://gutocarvalho.net/authors/gutocarvalho/" title="Guto Carvalho">Guto Carvalho</a></h3><p>Navegando pelas nuvens nativas e pipelines infinitas.</p></div></footer></div></div></article><div class="main__right"></div></main><footer class="footer"><div class="footer__social"><a href="https://www.facebook.com/falagutera" class="facebook" aria-label="Facebook"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://www.twitter.com/gutocarvalho" class="twitter" aria-label="Twitter"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/falagutera" class="instagram" aria-label="Instagram"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/falagutera/" class="linkedin" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/falagutera" class="youtube" aria-label="Youtube"><svg class="icon"><use xlink:href="https://gutocarvalho.net/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright">License<br>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.<br>Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></div></footer></div></div><script defer="defer" src="https://gutocarvalho.net/assets/js/scripts.min.js?v=27706a8fe221267c1834098c796f44c1"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" class="pcb__title">Esse site usa cookies</div><div id="pcb-txt" class="pcb__txt">Esse site usa cookies apenas para verificar suas configura√ß√µes de browser e melhorar sua experi√™ncia na navega√ß√£o. N√£o guardaremos seus dados. <a href="#not-specified">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Save</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="#not-specified">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Experi√™ncia do usu√°rio</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Experi√™ncia do usu√°rio</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookies Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
       if (!document.querySelector('.pcb')) {
           return;
       }
   
       var cbConfig = {
           behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
           behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
           revision: document.querySelector('.pcb').getAttribute('data-revision'),
           configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
           debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
           initialState: null,
           previouslyAccepted: []
       };
   
       var cbUI = {
           wrapper: document.querySelector('.pcb'),
           banner: {
               element: null,
               btnAccept: null,
               btnReject: null,
               btnConfigure: null
           },
           popup: {
               element: null,
               btnClose: null,
               btnSave: null,
               btnAccept: null,
               btnReject: null,
               checkboxes: null,
           },
           overlay: null,
           badge: null,
           blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
           triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
       };
   
       function initUI () {
           // setup banner elements
           cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
           cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
           cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
           cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');
   
           // setup popup elements
           if (cbUI.wrapper.querySelector('.pcb__popup')) {
               cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
               cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
               cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
               cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
               cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
               cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
               // setup overlay
               cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
           }
   
           cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');
   
           if (cbConfig.behaviour.indexOf('link') > -1) {
               for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                   cbUI.triggerLinks[i].addEventListener('click', function(e) {
                       e.preventDefault();
                       showBannerOrPopup();
                   });
               }
           }
       }
   
       function initState () {
           var lsKeyName = getConfigName();
           var currentConfig = localStorage.getItem(lsKeyName);
           var configIsFresh = checkIfConfigIsFresh();
   
           if (!configIsFresh || currentConfig === null) {
               if (cbConfig.debugMode) {
                   console.log('üç™ Config not found, or configuration expired');
               }
   
               showBanner();
           } else if (typeof currentConfig === 'string') {
               if (cbConfig.debugMode) {
                   console.log('üç™ Config founded');
               }
   
               showBadge();
   
               if (cbUI.popup.element) {
                   var allowedGroups = currentConfig.split(',');
                   var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
   
                   for (var j = 0; j < checkedCheckboxes.length; j++) {
                       var name = checkedCheckboxes[j].getAttribute('data-group-name');
   
                       if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                           checkedCheckboxes[j].checked = false;
                       }
                   }
   
                   for (var i = 0; i < allowedGroups.length; i++) {
                       var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');
   
                       if (checkbox) {
                           checkbox.checked = true;
                       }
   
                       allowCookieGroup(allowedGroups[i]);
                   }
               }
           }
   
           setTimeout(function () {
               cbConfig.initialState = getInitialStateOfConsents();
           }, 0);
       }
   
       function checkIfConfigIsFresh () {
           var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');
   
           if (lastConfigSave === null) {
               return false;
           }
   
           lastConfigSave = parseInt(lastConfigSave, 10);
   
           if (lastConfigSave === 0) {
               return true;
           }
   
           if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
               return true;
           }
   
           return false;
       }
   
       function initBannerEvents () {
           cbUI.banner.btnAccept.addEventListener('click', function (e) {
               e.preventDefault();
               acceptAllCookies('banner');
               showBadge();
           }, false);
   
           if (cbUI.banner.btnReject) {
               cbUI.banner.btnReject.addEventListener('click', function (e) {
                   e.preventDefault();
                   rejectAllCookies();
                   showBadge();
               }, false);
           }
   
           if (cbUI.banner.btnConfigure) {
               cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                   e.preventDefault();
                   hideBanner();
                   showAdvancedPopup();
                   showBadge();
               }, false);
           }
       }
   
       function initPopupEvents () {
           if (!cbUI.popup.element) {
               return;
           }
   
           cbUI.overlay.addEventListener('click', function (e) {
               hideAdvancedPopup();
           }, false);
   
           cbUI.popup.element.addEventListener('click', function (e) {
               e.stopPropagation();
           }, false);
   
           cbUI.popup.btnAccept.addEventListener('click', function (e) {
               e.preventDefault();
               acceptAllCookies('popup');
           }, false);
   
           cbUI.popup.btnReject.addEventListener('click', function (e) {
               e.preventDefault();
               rejectAllCookies();
           }, false);
   
           cbUI.popup.btnSave.addEventListener('click', function (e) {
               e.preventDefault();
               saveConfiguration();
           }, false);
   
           cbUI.popup.btnClose.addEventListener('click', function (e) {
               e.preventDefault();
               hideAdvancedPopup();
           }, false);
       }
   
       function initBadgeEvents () {
           if (!cbUI.badge) {
               return;
           }
   
           cbUI.badge.addEventListener('click', function (e) {
               showBannerOrPopup();
           }, false);
       }
   
       initUI();
       initState();
       initBannerEvents();
       initPopupEvents();
       initBadgeEvents();
   
       /**
        * API
        */
       function addScript (src, inline) {
           var newScript = document.createElement('script');
   
           if (src) {
               newScript.setAttribute('src', src);
           }
   
           if (inline) {
               newScript.text = inline;
           }
   
           document.body.appendChild(newScript);
       }
   
       function allowCookieGroup (allowedGroup) {
           var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
           cbConfig.previouslyAccepted.push(allowedGroup);
       
           for (var j = 0; j < scripts.length; j++) {
               addScript(scripts[j].src, scripts[j].text);
           }
   
           var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
           document.body.dispatchEvent(groupEvent);
           unlockEmbeds(allowedGroup);
   
           if (cbConfig.debugMode) {
               console.log('üç™ Allowed group: ' + allowedGroup);
           }
       }
   
       function showBannerOrPopup () {
           if (cbUI.popup.element) {
               showAdvancedPopup();
           } else {
               showBanner();
           }
       }
   
       function showAdvancedPopup () {
           cbUI.popup.element.classList.add('is-visible');
           cbUI.overlay.classList.add('is-visible');
           cbUI.popup.element.setAttribute('aria-hidden', 'false');
           cbUI.overlay.setAttribute('aria-hidden', 'false');
       }
   
       function hideAdvancedPopup () {
           cbUI.popup.element.classList.remove('is-visible');
           cbUI.overlay.classList.remove('is-visible');
           cbUI.popup.element.setAttribute('aria-hidden', 'true');
           cbUI.overlay.setAttribute('aria-hidden', 'true');
       }
   
       function showBanner () {
           cbUI.banner.element.classList.add('is-visible');
           cbUI.banner.element.setAttribute('aria-hidden', 'false');
       }
   
       function hideBanner () {
           cbUI.banner.element.classList.remove('is-visible');
           cbUI.banner.element.setAttribute('aria-hidden', 'true');
       }
   
       function showBadge () {
           if (!cbUI.badge) {
               return;
           }
   
           cbUI.badge.classList.add('is-visible');
           cbUI.badge.setAttribute('aria-hidden', 'false');
       }
   
       function getConfigName () {
           var lsKeyName = 'publii-gdpr-allowed-cookies';
   
           if (cbConfig.revision) {
               lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
           }
   
           return lsKeyName;
       }
   
       function storeConfiguration (allowedGroups) {
           var lsKeyName = getConfigName();
           var dataToStore = allowedGroups.join(',');
           localStorage.setItem(lsKeyName, dataToStore);
   
           if (cbConfig.configTTL === 0) {
               localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);
   
               if (cbConfig.debugMode) {
                   console.log('üç™ Store never expiring configuration');
               }
           } else {
               localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
           }
       }
   
       function getInitialStateOfConsents () {
           if (!cbUI.popup.element) {
               return [];
           }
   
           var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
           var groups = [];
   
           for (var i = 0; i < checkedGroups.length; i++) {
               var allowedGroup = checkedGroups[i].getAttribute('data-group-name');
   
               if (allowedGroup !== '') {
                   groups.push(allowedGroup);
               }
           }
   
           if (cbConfig.debugMode) {
               console.log('üç™ Initial state: ' + groups.join(', '));
           }
   
           return groups;
       }
   
       function getCurrentStateOfConsents () {
           if (!cbUI.popup.element) {
               return [];
           }
   
           var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
           var groups = [];
   
           for (var i = 0; i < checkedGroups.length; i++) {
               var allowedGroup = checkedGroups[i].getAttribute('data-group-name');
   
               if (allowedGroup !== '') {
                   groups.push(allowedGroup);
               }
           }
   
           if (cbConfig.debugMode) {
               console.log('üç™ State to save: ' + groups.join(', '));
           }
   
           return groups;
       }
   
       function getAllGroups () {
           if (!cbUI.popup.element) {
               return [];
           }
   
           var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
           var groups = [];
   
           for (var i = 0; i < checkedGroups.length; i++) {
               var allowedGroup = checkedGroups[i].getAttribute('data-group-name');
   
               if (allowedGroup !== '') {
                   groups.push(allowedGroup);
               }
           }
   
           return groups;
       }
   
       function acceptAllCookies (source) {
           var groupsToAccept = getAllGroups();
           storeConfiguration(groupsToAccept);
   
           for (var i = 0; i < groupsToAccept.length; i++) {
               var group = groupsToAccept[i];
   
               if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                   if (cbConfig.debugMode) {
                       console.log('üç™ Skip previously activated group: ' + group);
                   }
   
                   continue;
               }
   
               allowCookieGroup(group);
           }
   
           if (cbUI.popup.element) {
               var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
   
               for (var j = 0; j < checkboxesToCheck.length; j++) {
                   checkboxesToCheck[j].checked = true;
               }
           }
   
           if (cbConfig.debugMode) {
               console.log('üç™ Accept all cookies: ', groupsToAccept.join(', '));
           }
   
           if (source === 'popup') {
               hideAdvancedPopup();
           } else if (source === 'banner') {
               hideBanner();
           }
       }
   
       function rejectAllCookies () {
           if (cbConfig.debugMode) {
               console.log('üç™ Reject all cookies');
           }
   
           storeConfiguration([]);
           setTimeout(function () {
               window.location.reload();
           }, 100);
       }
   
       function saveConfiguration () {
           var groupsToAccept = getCurrentStateOfConsents();
           storeConfiguration(groupsToAccept);
   
           if (cbConfig.debugMode) {
               console.log('üç™ Save new config: ', groupsToAccept.join(', '));
           }
   
           if (reloadIsNeeded(groupsToAccept)) {
               setTimeout(function () {
                   window.location.reload();
               }, 100);
               return;
           }
   
           for (var i = 0; i < groupsToAccept.length; i++) {
               var group = groupsToAccept[i];
   
               if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                   if (cbConfig.debugMode) {
                       console.log('üç™ Skip previously activated group: ' + group);
                   }
   
                   continue;
               }
   
               allowCookieGroup(group);
           }
   
           hideAdvancedPopup();
       }
   
       function reloadIsNeeded (groupsToAccept) {
           // check if user rejected consent for initial groups
           var initialGroups = cbConfig.initialState;
           var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
           var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);
   
           for (var i = 0; i < groupsToCheck.length; i++) {
               var groupToCheck = groupsToCheck[i];
   
               if (groupsToAccept.indexOf(groupToCheck) === -1) {
                   if (cbConfig.debugMode) {
                       console.log('üç™ Reload is needed due lack of: ', groupToCheck);
                   }
   
                   return true;
               }
           }
   
           return false;
       }
   
       function unlockEmbeds (cookieGroup) {
           var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');
   
           for (var i = 0; i < iframesToUnlock.length; i++) {
               var iframeWrapper = iframesToUnlock[i];
               iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
               iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
               var iframe = iframeWrapper.querySelector('iframe');
               iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
           }
       }
   
       win.publiiEmbedConsentGiven = function (cookieGroup) {
           // it will unlock embeds
           allowCookieGroup(cookieGroup);
   
           var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');
   
           if (checkbox) {
               checkbox.checked = true;
           }
   
           var groupsToAccept = getCurrentStateOfConsents();
           storeConfiguration(groupsToAccept);
   
           if (cbConfig.debugMode) {
               console.log('üç™ Save new config: ', groupsToAccept.join(', '));
           }
       }
   })(window);</script></body></html>