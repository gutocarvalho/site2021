{
    "version": "https://jsonfeed.org/version/1",
    "title": "Guto@Site",
    "description": "",
    "home_page_url": "https://gutocarvalho.net",
    "feed_url": "https://gutocarvalho.net/feed.json",
    "user_comment": "",
    "author": {
        "name": "Guto Carvalho"
    },
    "items": [
        {
            "id": "https://gutocarvalho.net/keptn-outro-projeto-para-ficar-de-olho/",
            "url": "https://gutocarvalho.net/keptn-outro-projeto-para-ficar-de-olho/",
            "title": "Keptn, outro projeto para ficar de olho!",
            "summary": "O Keptn (fala-se Captain) é um control-plane para automação com mindset devops&hellip;",
            "content_html": "<p>O Keptn (fala-se Captain) é um control-plane para automação com mindset devops dentro do seu cluster. <br><br>Esse projeto promete – entre outras coisas – te ajudar a manter a qualidade das APPs em seu cluster usando o que eles chamam de quality gates (é o que chamou minha atenção). Os quality gates usam SLIs e SLOs de sua APP para cuidar de sua APP, isso significa que caso você publique algo está fora dos padrões que você indicou, o Keptn faz o rollback para a última versão que tem a performance dentro dos seus indicadores.</p>\n<p>Além disso temos recursos como:<br><br>- Multi-stage delivery<br>- Continuous Performance Verification<br>- Configuração declarativa<br>- Automação baseada em eventos<br>- Integração com projetos como Argo, GitHub Actions, Prometheus e +<br>- Observabilidade nativa para poder checar SLIs e SLOs<br><br>E tem muito mais, conheça <a href=\"https://keptn.sh\">https://keptn.sh.</a></p>\n<figure class=\"post__video\"><iframe loading=\"lazy\" width=\"560\" height=\"314\" src=\"https://www.youtube.com/embed/fjfj97Vb4ds\" allowfullscreen=\"allowfullscreen\" data-mce-fragment=\"1\"></iframe></figure>\n<p>É isso povo!<br><br>[s]<br><br></p>\n<p> </p>",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "MindNotes"
            ],
            "date_published": "2021-12-15T08:35:41-03:00",
            "date_modified": "2021-12-15T08:54:16-03:00"
        },
        {
            "id": "https://gutocarvalho.net/karpenter-novo-autoscaler-para-k8s-da-aws/",
            "url": "https://gutocarvalho.net/karpenter-novo-autoscaler-para-k8s-da-aws/",
            "title": "Karpenter, novo autoscaler para k8s da AWS",
            "summary": "Se ainda não conhece se liga no Karpenter, um novo autoscaler desenvolvido&hellip;",
            "content_html": "<p>Se ainda não conhece se liga no Karpenter, um novo autoscaler desenvolvido pelo time da AWS para te ajudar com seu cluster.</p>\n<p><a href=\"https://github.com/aws/karpenter\">https://github.com/aws/karpenter</a></p>\n<figure class=\"post__video\"><iframe loading=\"lazy\" width=\"560\" height=\"314\" src=\"https://www.youtube.com/embed/3QsVRHVdOnM?feature=emb_title\" allowfullscreen=\"allowfullscreen\" data-mce-fragment=\"1\"></iframe></figure>\n<figure class=\"post__video\"><iframe loading=\"lazy\" width=\"560\" height=\"314\" src=\"https://www.youtube.com/embed/qxWJRUF6JJc?feature=youtu\" allowfullscreen=\"allowfullscreen\" data-mce-fragment=\"1\"></iframe></figure>\n<p>É só isso mesmo!<br><br>[s]</p>",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "MindNotes"
            ],
            "date_published": "2021-12-15T08:28:16-03:00",
            "date_modified": "2021-12-15T08:28:16-03:00"
        },
        {
            "id": "https://gutocarvalho.net/teste-de-carga-com-ajuda-do-vegeta/",
            "url": "https://gutocarvalho.net/teste-de-carga-com-ajuda-do-vegeta/",
            "title": "Teste de carga com ajuda do vegeta?",
            "summary": "Quer fazer um teste de carga? Conheça o Vegeta! https://github.com/tsenart/vegeta É só&hellip;",
            "content_html": "<figure class=\"post__image\">Quer fazer um teste de carga?<br><br>Conheça o Vegeta!<br><br><img loading=\"lazy\"  src=\"https://camo.githubusercontent.com/faf9be097f4731212debdd24210c750b2dc276d0a17df19c6a8ac026427c09e9/687474703a2f2f666330392e64657669616e746172742e6e65742f667334392f692f323030392f3139382f632f632f73736a325f7665676574615f62795f7472756e6b7332342e6a7067\" data-is-external-image=\"true\"  alt=\"\" width=\"600\" height=\"852\"></figure><br><br><a href=\"https://github.com/tsenart/vegeta\">https://github.com/tsenart/vegeta</a><br><br>É só isso mesmo.<br><br>[s]</p>",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "MindNotes"
            ],
            "date_published": "2021-12-15T08:20:31-03:00",
            "date_modified": "2021-12-15T08:21:21-03:00"
        },
        {
            "id": "https://gutocarvalho.net/entendendo-o-service-mesh/",
            "url": "https://gutocarvalho.net/entendendo-o-service-mesh/",
            "title": "Entendendo service mesh",
            "summary": "<p>Venha entender o que é service mesh!</p>\n",
            "content_html": "<p>Venha entender o que é service mesh!</p>\n\n<p>Esse documento foi escrito originalmente em inglês para um job, mas vou aproveitar para colocar aq no blog, se esqueci de traduzir algo me avise ;)<br><br><strong>## 1. O que é service Mesh e para que serve isso?</strong><br><br>Você provavelmente já ouviu falar sobre isso, e normalmente na mesma frase que alguém cita o tal do \"service mesh\" geralmente vem junto um \"IstIO\" ou \"Linkerd\", ambos implementações bastante populartes desta camada de abstração de rede.<br><br>Antes de entrar no modelo de abstração em si, vamos falar de algo realmente importante que permite o uso útil do service mesh, e neste caso, falamos especificamente dos microserviços.<br><br>Nos últimos anos essa é outra das buzzwords que tem dominado as conversas nos corredores de TI, mas é bom entender desde já que microserviços e containers não são a mesma coisa não dependem um do outro, contudo, ainda assim, microserviços em containers fazem todo o sentido, tal como juntar o queijo com a goiabada.<br><br>Ainda assim, microserviços podem rodar fora de containers, sem nenhum problema.<br><br><strong>## 2. Entendendo os microserviços</strong><br><br>Essa tendência de migração para microserviços – a qual tem se tornado muito popular na última década, basicamente se refere a decompor ou quebrar grandes monolitos de software em pedaços menores e independentes, chamados então de microserviços.<br><br>Pense no seguinte exemplo, imagine uma empresa área que rodava toda sua operação em um grande monolito que fazia tudo de ponta a ponta, contudo, tal monito era igualmente indomávele e difícil de escalar, atualizar, manter e operar. Depois de algum tempo a empresa decidiu decompor o monolito em pedaços menores, separando serviços como pagamento, atendimento do passageiro, atividades dos comissários, atividades dos pilotos, atividades dos mecânicos, venda de passagens, despacho de bagagem e marcação de assentos em pedaços únicos, independentes, que se comunicam entre si, conforme necessidade, utilizando para essa comunicação as API's, geralmente do tipo REST.<br><br>Ao decompor esse grande monolito, por um lado, é reduzida a complexidade em alguns pontos, o que facilita a evolução de determinados aspectos do negócio, reduz o risco e acelera a entrega. Além disso, os microserviços permitem que se utilizem técnicas de escalabilidade horizontal, o que faz muito sentido para o universo de containers, clusters de containers e orquestradores de clusters de containers.<br><br>Nem sempre redução da complexidade é um benefício bem aceito, muitos defendem que aumenta a complexidade, isso você poderá julgar e formar opinião com o tempo :)<br><br><strong>## 3. Vantagens dos microserviços</strong><br><br>Podemos ter times específicos e dedicados a manter um determinado serviço do negócio.<br><br>Como os componentes são independentes, uma vez definidos padrões de comunicação, interoperação, monitoramento, observação, operação e entrega, cada time tem mais liberdade de escolher a \"melhor\" STACK para criar e manter o serviço, desde que esta esteja aderente aos \"macro\" padrões previamente definidos pelos arquitetos.<br><br>O custo de operação – a médio e longo prazo - e manutenção tende a ser menor.<br><br>A disponibilidade do serviço - a médio e longo prazo – tende a ser maior.<br><br>A velocidade de entrega tende a ser muito maior.<br><br>O LEAD time (tempo da ideia de uma feature ao momento de entrar produção) tende a ser MUITO menor.<br><br>O tempo de recuperação (MTTR) de um incidente ou falha tende a ser menor.<br><br>A curva de aprendizado do time que vai manter o software é significantemente menor pois ele vai focar nos padrões definidos e nos requisitos de negócio do serviço de que seu time é responsável. <br><br>A atualização se torna mais simples e com menor risco, afinal você não está mudando o monolito inteiro, está mudando apenas a versão de um serviço, e pode inclusive retornar a versão anterior sem grandes e elaborados processos de mudança.<br><br>A escalabilidade horizontal passa a ser uma opção, permitindo em momentos de pico de acessos, aumentar o tamanho e a quantidade de microserviços atendendo requisições dos clientes, e após o pico, retornar ao tamanho e oferta normal de atendimento das requisições.<br><br>Quem ainda não está rodando nesse modelo, está se preparando para isso, ou já está em transição para ele.<br><br>Quem não está rodando nesse modelo, nem no processo de transição, nem se preparando, provavelmente sumirá do mercado em breve – de verdade.<br><br><strong>## 4. Nem tudo são flores nos microserviços</strong><br><br>O processo de decompor é complexo, necessita de apoio de arquitetos, engenheiros, desenvolvedores, analistas e também de recursos computacionais, financeiros, de aprovações em N níveis, além de um amplo entendimento e também da vontade de todos para fazer a transição funcionar da melhor forma.<br><br>Decompor demais também pode ser um problema, é preciso ter equilíbrio ou você gera novamente complexidade devido a imensa quantidade de serviços interconectados, onde, caso ocorra um problema, o nível de abstração aumenta imensamente a complexidade e o alcance do troubleshooting para resolução do problema.<br><br>Esse modelo também pode ser bem mais caro – normalmente <br>é – do que previsto no início – devido a incertezas, contudo, de médio a longo prazo os resultados são muito visíveis, do ponto de vista financeiro, operação e disponibilidade.<br><br>Monitoramento e operação também precisam estar afinados com todo o processo, a cultura SRE, DevOps, DevSecOps, GitOps e FinOps trazem experiências e indicam os caminhos e os possíveis percalços, permitindo desviar das estradas ruins, ainda assim, os engenheiros tem que dominar o conceito da infraestrutura como código, infraestrutura imutável, continuous integration, continuous delivery, containerização e orquestração de containers para que quando alguém comite código no lado esquerdo, algo saia rodando lá na ponta do lado direito de forma natural, controlada e com visibilidade plena.<br><br>Nesse processo de transição, a segurança tem que estar contida desde o dia zero no mindset de cada desenvolvedor e engenheiro, bem como a exposição de métricas e informações, tudo visando garantir o monitoramento e a observabilidade, bem como a adoção de uma madura cultura de testes que devem ser integrados a esteira.<br><br>No final, posso dizer que a transição funciona, está comprovado, tem cases fantásticos, mas não é fácil e não é simples como iniciar um novo projeto já com esses conceitos incutidos, mas dá para fazer, tenha certeza disso.<br><br><strong>## 5. Mas oq é esse tal de service mesh afinal?</strong><br><br>Service Mesh é basicamente uma camada de infraestrutura criada para controlar a comunicação serviço a serviço em um arquitetura de microserviços. <br><br>Ele controla a entrega das requisições para outros serviços, atua como load balancer, pode criptografar dados, descobrir serviços e agregá-los ao load balancer de sua APP.<br><br>Apesar de você poder determinar em seu código a lógica de comunicação de seu microserviço, o service mesh atua como uma abstração desta lógica, em uma camada paralela de infraestrutura, dedicada a isso. O funcionamento é bastante simples, ele injeta sidecars proxy em cada serviço.<br><br>O sidecar proxy oferece ao controlador mesh os dados do serviço e permite a troca de informações entre os serviços. O controlador service mesh em posse desses dados pode fazer todo o plano de funcionamento e comportamento da aplicação e seus serviços disponíveis. A aplicação de service mesh tem um \"control plane\" próprio e também oferece uma API que te permite gerenciar o tráfego, resiliência da rede, segurança, autenticação e telemetria de cada serviço.<br><br><strong>## 6. Pq eu preciso desse service mesh?</strong><br><br><strong>### 6.1. Performance e roteamento</strong><br> <br>Se você tem uma aplicação que atende uma demanda bastante grande, sendo essa aplicação composta de diversos microserviços se comunicando entre si, o fluxo de comunicação pode se tornar um desafio, uma vez que as requisições entre os serviços podem crescer de forma exponencial, neste caso você provavelmente vai precisar de um roteamento sofisticado e inteligente para manter a comunicação fluindo corretamente, e principalmente para manter a performance dentro dos padrões esperados, evitando degradar a comunicação entre os serviços.<br><br><strong>### 6.2. Segurança</strong><br><br>Você pode desejar que a comunicação entre os serviços seja segura com TLS mútuo, o que chamamos de mTLS.<br><br><strong>### 6.3. Melhorar a sua estratégia DevOps</strong><br><br>Permite que os times gerenciem as políticas de segurança e acesso através de código e integre isso nas pipelines CI/CD que entregam o software para o cluster.<br><br><strong>## 7. Quais os principais benefícios do service mesh?</strong><br><br>### Observabilidade<br><br>Normalmente times usam diferentes métodos e tecnologias para manter a visibilidade em relação ao tráfego, log, métricas, tracing e controles de segurança. O service mesh já traz tudo isso de forma centralizada e organizada.<br><br>### Resiliência<br><br>O service mesh oferece mecanismos como Circuit Breaker, Latency Aware Load Balancing, um descobrimento de serviço bastante consistente e robusto, permitindo ainda configurar retries, timeouts e deadlines nestes serviços.<br><br>### Traffic Control &amp; Circuit Breaker<br><br>Podemos controlar de forma muito granular o roteamento de tráfego de rede para determinar de forma objetiva por onde as requisições serão roteadas. O circuit breaker permite detectar problemas e definir regras precisas que dizem quando ejetar um POD do load balancer e quando recolocar.<br><br>### Security<br><br>A maioria dos service meshs oferece um mecanismo CA que gera certificados de forma dinâmica para cada serviço, garantindo uma comunicação segura serviço a serviço.<br><br>### Deploy strategies<br><br>Quando você precisa utilizar estratégias de deploy como Canary, Blue/Green, Dark Launch e não quer construir essa lógica na sua APP ou preparar isso em infraestrutura do zero.<br><br>### Delay, rate control &amp; fault injection<br><br>A maioria dos service meshs oferece forma de configurar latência e falhas para simular oq aconteceria no mundo real. Dessa forma você vai verificar qual o comportamento dos seus serviços no caso desse tipo de cenário. É possível também configurar rate limit para um determinado serviço.<br><br>### Less code para Devs<br><br>Os recursos contidos no service mesh reduzem sensivelmente a quantidade de código que precisa ser produzida pelos devs pois muita coisa já está pronta e disponível nesta camada de abstração que conecta os serviços.<br><br>### Less code para Ops<br><br>Da mesma forma os OPs não precisam demandar aos Devs formas de coletar métricas, logs, falar sobre retries, timeouts, disponibilidade e performance, pois esse conjunto de informações e configurações já é oferecido nativamente pelo service mesh.<br><br><strong>## 8. Quais os principais drawbacks para o cliente e para a operação?</strong><br><br>Aumenta a quantidade de pontos de falha - não tem jeito, é mais um componente central que precisa ser considerado, operado, gerido e atualizado.<br><br>Os principais projetos relacionados a service MESH estão em constante evolução, muita coisa nova está sendo criada, testada, e vamos navegar nesses mares com muitas coisas novas, atualizações podem ser desafiadores conforme a tecnologia evolui.<br><br>Aumenta a complexidade da operação de seu ambiente, pois agora além de pods e réplicas, precisamos pensar no service mesh e sua arquitetura.<br><br>A implementação inicial é simples, mas a personalização para as necessidades do clientes requer bastante esforço.<br><br>A curva de aprendizado pode ser de média a longo prazo até o time dominar o serviço e sua arquitetura.<br><br>O service mesh resolve as coisas dentro de nossa infraestrutura, dentro de nossa operação, contudo ao desacoplar sua APP e iniciar a migração para o modelo microserviços, isso normalmente traz junto a necessidade de implementar um API Gateway, especialmente se você tem um grande número de microserviços a expor para fora da sua infra, isso tem de ser considerado e provavelmente será o próximo passado.<br><br><strong>## 8. Quando não usar service mesh?</strong><br><br>- Quando você não sabe para que serve<br>- Quando você não enxerga como isso vai ajudar sua operação<br>- Quando você não enxerga como isso vai ajudar sua app do ponto de vista de disponibilidade<br>- Quando você não enxerga como isso vai ajudar sua app do ponto de vista de peformance<br>- Quando você não enxerga como isso vai ajudar sua estratégia de negócio<br>- Quando o discovery default do K8S é suficiente para você<br>- Quando o rollout default do K8S é suficiente para você<br>- Quando você não tem um grande número de microserviços para gerenciar<br>- Quando você não tem microserviços, mas acha que tem<br>- Quando você não tem um fluxo massivo de requisições para lidar<br>- Quando você não precisa de comunicação segura entre os serviços<br><br><strong>## 9. O que vem por aí?</strong><br><br>Vamos dar uma olhada a 20 mil metros de altura no Istio e Linkerd e comparar os dois.<br><br><strong>## 10. Refs</strong><br><br>- https://en.wikipedia.org/wiki/Service_mesh<br>- https://www.cncf.io/blog/2017/04/26/service-mesh-critical-component-cloud-native-stack/<br>- https://www.cncf.io/blog/2021/07/15/networking-with-a-service-mesh-use-cases-best-practices-and-comparison-of-top-mesh-options/<br>- https://www.nginx.com/blog/what-is-a-service-mesh/<br>- https://buoyant.io/what-is-a-service-mesh<br>- https://www.dynatrace.com/news/blog/what-is-a-service-mesh/<br>- https://www.bmc.com/blogs/service-mesh/<br>- https://glasnostic.com/blog/service-mesh-istio-limits-and-benefits-part-1<br>- https://glasnostic.com/blog/service-mesh-istio-limits-and-benefits-part-2<br>- https://www.plugandplaytechcenter.com/resources/what-service-mesh-and-why-should-you-care-about-it<br>- https://www.limepoint.com/blog/5-reasons-why-you-should-consider-service-mesh<br>- https://enterprisersproject.com/article/2019/7/service-mesh-how-to-make-case<br>- https://www.xenonstack.com/insights/what-is-a-service-mesh<br>- https://www.mulesoft.com/lp/whitepaper/api/service-mesh-api-management<br>- https://thenewstack.io/when-you-do-and-dont-need-a-service-mesh/</p>",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "TLDR"
            ],
            "date_published": "2021-11-19T07:33:28-03:00",
            "date_modified": "2021-12-15T08:22:06-03:00"
        },
        {
            "id": "https://gutocarvalho.net/dashboards-para-k8s/",
            "url": "https://gutocarvalho.net/dashboards-para-k8s/",
            "title": "Dashboards para K8S",
            "summary": "Quer usar Dashboards para o Kubernetes? Bora! Algumas opções bastante conhecidas Projetos&hellip;",
            "content_html": "<p>Quer usar Dashboards para o Kubernetes? Bora!</p>\n<p>Algumas opções bastante conhecidas</p>\n<ul>\n<li><a href=\"https://rancher.com/docs/rancher/v2.6/en/\">https://rancher.com/docs/rancher/v2.6/en/</a></li>\n<li><a href=\"https://github.com/kubernetes/dashboard\">https://github.com/kubernetes/dashboard</a></li>\n<li><a href=\"https://www.portainer.io\">https://www.portainer.io</a></li>\n<li><a href=\"https://www.weave.works/oss/scope\">https://www.weave.works/oss/scope</a></li>\n</ul>\n<p>Projetos promissores</p>\n<ul>\n<li><a href=\"https://octant.dev\">https://octant.dev</a></li>\n<li><a href=\"https://github.com/skooner-k8s/skooner\">https://github.com/skooner-k8s/skooner</a></li>\n<li><a href=\"https://kubevious.io\">https://kubevious.io</a> (esse é bem interessante)</li>\n</ul>\n<p>Para terminal</p>\n<ul>\n<li><a href=\"https://codeberg.org/hjacobs/kube-ops-view\">https://codeberg.org/hjacobs/kube-ops-view</a></li>\n<li><a href=\"https://k9scli.io\">https://k9scli.io</a></li>\n</ul>\n<p>Para seu desktop</p>\n<ul>\n<li><a href=\"https://k8slens.dev\">https://k8slens.dev</a></li>\n<li><a href=\"https://kubenav.io\">https://kubenav.io</a></li>\n</ul>\n<p>Para conhecer e testar</p>\n<ul>\n<li><a href=\"https://github.com/jeremykross/konstellate\">https://github.com/jeremykross/konstellate</a></li>\n<li><a href=\"https://github.com/smpio/kubernator\">https://github.com/smpio/kubernator</a></li>\n<li><a href=\"https://github.com/kubricksllc/Kubricks\">https://github.com/kubricksllc/Kubricks</a></li>\n</ul>\n<p>Gerador de relatórios de custos para AWS e GCP</p>\n<ul>\n<li><a href=\"https://codeberg.org/hjacobs/kube-resource-report\">https://codeberg.org/hjacobs/kube-resource-report</a></li>\n</ul>\n<p>[s]</p>\n",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "MindNotes"
            ],
            "date_published": "2021-11-18T10:28:11-03:00",
            "date_modified": "2021-11-18T10:54:36-03:00"
        },
        {
            "id": "https://gutocarvalho.net/instalando-istio-via-helm-para-testes/",
            "url": "https://gutocarvalho.net/instalando-istio-via-helm-para-testes/",
            "title": "DROPS: Instalando ISTIO via helm para testes",
            "summary": "Aprendar a instalar o Istio via Helm em poucos passos. O Istio&hellip;",
            "content_html": "<p>Aprendar a instalar o Istio via Helm em poucos passos.</p>\n<hr>\n<p>O Istio é uma implementação de service mesh, falaremos oq é isso em outro post!</p>\n<h2 id=\"instalando\">Instalando</h2>\n<p>crie um diretório</p>\n<pre><code>$ mkdir istio &amp;&amp; cd istio\n</code></pre>\n<p>baixe o pacote</p>\n<pre><code>$ curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.11.4 TARGET_ARCH=x86_64 sh -\n</code></pre>\n<p>Crie o namespace</p>\n<pre><code>$ kubectl create namespace istio-system \n</code></pre>\n<p>Instale o pacote base (CRD’s)</p>\n<pre><code>$ helm install istio-base istio-1.11.4/manifests/charts/base -n istio-system\n</code></pre>\n<p>Instale o istiod (Services)</p>\n<pre><code>$ helm install istiod istio-1.11.4/manifests/charts/istio-control/istio-discovery -n istio-system\n</code></pre>\n<p>Instale o istio ingress (opcional)</p>\n<pre><code>$ helm install istio-ingress istio-1.11.4/manifests/charts/gateways/istio-ingress -n istio-system\n</code></pre>\n<p>Instale o istio egress (opcional)</p>\n<pre><code>$ helm install istio-egress istio-1.11.4/manifests/charts/gateways/istio-egress -n istio-system\n</code></pre>\n<h2 id=\"validando\">Validando</h2>\n<p>Verifique</p>\n<pre><code>$ kubectl get pods -n istio-system\n</code></pre>\n<p>Saída esperada</p>\n<pre><code>NAME                                    READY   STATUS    RESTARTS   AGE\nistio-egressgateway-6674469d89-zz4h8    1/1     Running   0          12m\nistio-ingressgateway-55cf46987b-5lcxj   1/1     Running   0          13m\nistiod-7556556fcc-7bcf8                 1/1     Running   0          13m\n</code></pre>\n<p>Verifique</p>\n<pre><code>$ kubectl get istio-io --all-namespaces\n</code></pre>\n<p>Saída esperada</p>\n<pre><code>NAMESPACE      NAME                                                         AGE\nistio-system   envoyfilter.networking.istio.io/metadata-exchange-1.10       13m\nistio-system   envoyfilter.networking.istio.io/metadata-exchange-1.11       13m\nistio-system   envoyfilter.networking.istio.io/metadata-exchange-1.9        13m\nistio-system   envoyfilter.networking.istio.io/stats-filter-1.10            13m\nistio-system   envoyfilter.networking.istio.io/stats-filter-1.11            13m\nistio-system   envoyfilter.networking.istio.io/stats-filter-1.9             13m\nistio-system   envoyfilter.networking.istio.io/tcp-metadata-exchange-1.10   13m\nistio-system   envoyfilter.networking.istio.io/tcp-metadata-exchange-1.11   13m\nistio-system   envoyfilter.networking.istio.io/tcp-metadata-exchange-1.9    13m\nistio-system   envoyfilter.networking.istio.io/tcp-stats-filter-1.10        13m\nistio-system   envoyfilter.networking.istio.io/tcp-stats-filter-1.11        13m\nistio-system   envoyfilter.networking.istio.io/tcp-stats-filter-1.9         13m\n</code></pre>\n<h2 id=\"removendo\">Removendo</h2>\n<p>Numa tacada só</p>\n<pre><code>$ helm uninstall istio-base istio-egress istio-ingress istiod -n istio-system\n</code></pre>\n<p>Saída esperada</p>\n<pre><code>release &quot;istio-base&quot; uninstalled\nrelease &quot;istio-egress&quot; uninstalled\nrelease &quot;istio-ingress&quot; uninstalled\nrelease &quot;istiod&quot; uninstalled\n</code></pre>\n<p>Removendo o namespace</p>\n<pre><code>$ kubectl delete namespace istio-system\n</code></pre>\n<pre><code>namespace &quot;istio-system&quot; deleted\n</code></pre>\n<p>Removendo CRDs</p>\n<pre><code>$ kubectl get crd | grep --color=never &#39;istio.io&#39; | awk &#39;{print $1}&#39;| xargs -n1 kubectl delete crd\n</code></pre>\n<p>Saída esperada</p>\n<pre><code>customresourcedefinition.apiextensions.k8s.io &quot;adapters.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;attributemanifests.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;authorizationpolicies.security.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;clusterrbacconfigs.rbac.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;destinationrules.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;envoyfilters.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;gateways.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;handlers.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;httpapispecbindings.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;httpapispecs.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;instances.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;istiooperators.install.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;peerauthentications.security.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;quotaspecbindings.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;quotaspecs.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;rbacconfigs.rbac.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;requestauthentications.security.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;rules.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;serviceentries.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;servicerolebindings.rbac.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;serviceroles.rbac.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;sidecars.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;telemetries.telemetry.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;templates.config.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;virtualservices.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;workloadentries.networking.istio.io&quot; deleted\ncustomresourcedefinition.apiextensions.k8s.io &quot;workloadgroups.networking.istio.io&quot; deleted\n</code></pre>\n<h2 id=\"refs\">Refs</h2>\n<ul>\n<li><a href=\"https://istio.io/latest/docs/setup/getting-started/\">https://istio.io/latest/docs/setup/getting-started/</a></li>\n<li><a href=\"https://istio.io/latest/docs/setup/install/\">https://istio.io/latest/docs/setup/install/</a></li>\n<li><a href=\"https://istio.io/latest/docs/setup/install/helm/\">https://istio.io/latest/docs/setup/install/helm/</a></li>\n</ul>\n",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "Projetos",
                   "K8S",
                   "Drops"
            ],
            "date_published": "2021-11-08T16:29:04-03:00",
            "date_modified": "2021-11-08T16:32:24-03:00"
        },
        {
            "id": "https://gutocarvalho.net/dicas-sobre-quadros-e-canetas/",
            "url": "https://gutocarvalho.net/dicas-sobre-quadros-e-canetas/",
            "title": "Dicas sobre quadros e canetas!",
            "summary": "<p>Pessoal, seguem algumas dicas sobre quadros para escrever em casa.</p>\n",
            "content_html": "<p>Pessoal, seguem algumas dicas sobre quadros para escrever em casa.</p>\n\n<figure class=\"post__image\">Eu sou desses que tem vários quadros – para escrever com canetinha – em casa, tenho de vidro, de metal, de madeira, e outros tipos, eu gosto de escrever para lembrar das coisas, para deixar recados para as crianças, para deixar recados pra mim, para organizar atividades. Eu acho que os quadros sempre estiverem presentes na minha vida, eu não sei viver sem eles.<br><br><img loading=\"lazy\"  src=\"https://gutocarvalho.net/media/posts/72/quadro_vidro.jpg\" sizes=\"(min-width: 61.3125em) 50vw, 100vw\" srcset=\"https://gutocarvalho.net/media/posts/72/responsive/quadro_vidro-xs.jpg 300w ,https://gutocarvalho.net/media/posts/72/responsive/quadro_vidro-sm.jpg 480w ,https://gutocarvalho.net/media/posts/72/responsive/quadro_vidro-md.jpg 768w\"  alt=\"\" width=\"1280\" height=\"960\"></figure><br><br>Eu escrevo até nos espelhos :)</p>\n<div class=\"gallery-wrapper\"><div class=\"gallery\"  data-is-empty=\"false\" data-columns=\"2\">\n<figure class=\"gallery__item\"><a href=\"https://gutocarvalho.net/media/posts/72/gallery/espelho1-2.jpg\" data-size=\"960x1280\"><img loading=\"lazy\" src=\"https://gutocarvalho.net/media/posts/72/gallery/espelho1-2-thumbnail.jpg\" alt=\"\" width=\"768\" height=\"1024\"></a></figure>\n<figure class=\"gallery__item\"><a href=\"https://gutocarvalho.net/media/posts/72/gallery/espelho2-2.jpg\" data-size=\"960x1280\"><img loading=\"lazy\" src=\"https://gutocarvalho.net/media/posts/72/gallery/espelho2-2-thumbnail.jpg\" alt=\"\" width=\"768\" height=\"1024\"></a></figure>\n</div></div>\n<p><br>Usando tantos quadros, por tantos anos, especialmente de vidro, a gente acaba experimentando uma série de canetas e aprendendo sobre elas. <br><br>Fiz esse post para ajudar você a escolher o melhor tipo de caneta e quadro para sua casa/escritório.<br><br><strong>Canetas com ponta grossa ( traço de 2 a 5 mm )</strong><br><br>No quesito caneta com ponta grossa, eu gosto muito das canetas da <a href=\"https://www.compactor.com.br/marcadores-qb/\">compactor</a> para quadro branco, são excelentes, uso há cerca de dois anos, e virou minha caneta padrão devido a qualidade e custo vs benefício.<br><br></p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://gutocarvalho.net/media/posts/72/Screen-Shot-2021-11-05-at-12.35.11.png\" sizes=\"(min-width: 61.3125em) 50vw, 100vw\" srcset=\"https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.35.11-xs.png 300w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.35.11-sm.png 480w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.35.11-md.png 768w\"  alt=\"\" width=\"562\" height=\"540\"></figure>\n<p>Elas funcionam muito bem para desenhar no geral, e no meu caso para rabiscar umas topologias, arquiteturas, redes, etc, ajuda muito no troubleshooting, na proposição de projetos e uso principalmente como \"lista de coisas a fazer\" :)<br><br>Ela está disponível nas cores azul, preta, vermelha, verde e rosa.<br><br>Sua ponta cônica é muito confortável e firme.<br><br>Oferece reservatório para recarga.<br><br><strong>Canetas com ponta fina ( traço de 1 a 2 mm )</strong></p>\n<p>Em alguns casos ponta grossa pode ser um problema, especialmente em quadros personalizados com pouco espaço para escrever, nestes quadros eu uso as canetas da <a href=\"https://www.staedtler.com/br/pt/produtos/marcador/marcador-para-quadro-branco/\">staedtler</a> lumocolor whiteboard, são maravilhosas.</p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://gutocarvalho.net/media/posts/72/Screen-Shot-2021-11-05-at-12.37.01.png\" sizes=\"(min-width: 61.3125em) 50vw, 100vw\" srcset=\"https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.37.01-xs.png 300w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.37.01-sm.png 480w ,https://gutocarvalho.net/media/posts/72/responsive/Screen-Shot-2021-11-05-at-12.37.01-md.png 768w\"  alt=\"\" width=\"441\" height=\"431\"></figure>\n<p> </p>\n<p><strong>Exemplo de traço grosso</strong><br><br></p>\n<div class=\"gallery-wrapper\"><div class=\"gallery\"  data-is-empty=\"false\" data-columns=\"2\">\n<figure class=\"gallery__item\"><a href=\"https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_grosso-3.jpg\" data-size=\"1280x960\"><img loading=\"lazy\" src=\"https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_grosso-3-thumbnail.jpg\" alt=\"\" width=\"768\" height=\"576\"></a></figure>\n<figure class=\"gallery__item\"><a href=\"https://gutocarvalho.net/media/posts/72/gallery/semana_traco_grosso-4.jpg\" data-size=\"1280x960\"><img loading=\"lazy\" src=\"https://gutocarvalho.net/media/posts/72/gallery/semana_traco_grosso-4-thumbnail.jpg\" alt=\"\" width=\"768\" height=\"576\"></a></figure>\n</div></div>\n<p><strong>Exemplo de Traço fino</strong><br><br></p>\n<div class=\"gallery-wrapper\"><div class=\"gallery\"  data-is-empty=\"false\" data-columns=\"2\">\n<figure class=\"gallery__item\"><a href=\"https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_fino.jpg\" data-size=\"1280x960\"><img loading=\"lazy\" src=\"https://gutocarvalho.net/media/posts/72/gallery/calendario_traco_fino-thumbnail.jpg\" alt=\"\" width=\"768\" height=\"576\"></a></figure>\n<figure class=\"gallery__item\"><a href=\"https://gutocarvalho.net/media/posts/72/gallery/semana_traco_fino.jpg\" data-size=\"1280x960\"><img loading=\"lazy\" src=\"https://gutocarvalho.net/media/posts/72/gallery/semana_traco_fino-thumbnail.jpg\" alt=\"\" width=\"768\" height=\"576\"></a></figure>\n</div></div>\n<p><br>Yeah, minha letra é complexa e exótica.<br><br><strong>Outras canetas que recomendo</strong><br><br>Já usei as canetas <a href=\"http://www.pilotpen.com.br/produtos/marc-wbma-v-board-master-para-quadro-branco/\">Pilot Board Master</a> recarregáveis, mais parei devido ao preço e a dificuldade de achar as recargas, fora que a recarga tava o preço da caneta, ai não compensava. Apesar de terem viajado no preço, são canetas boas , tem o traço grosso de 2 a 5 mm, são realmente bem bacanas especialmente para dar aulas, usei de 2013 a 2019 em especial, falando dessa marca e modelo.</p>\n<p>Recentemente descobri também as canetas da Faber Castell, são equivalentes ao Pilot Board Master e a Compactor.</p>\n<p>Quando as crianças querem desenhar eu compro uns kits de 4 canetas da bic, keep ou pilot modelo wbm-7, são mais baratas e viáveis para eles, do contrario eles acabam com minhas canetas pessoais em uma tarde.</p>\n<p><strong>Falando de Quadros</strong><br><br>Eu gosto desses quadros personalizados, eles normalmente são de metal, madeira ou até papelão, contudo hoje em dia eu prefiro quadros de vidro, vou até tentar refazer esses dois da foto acima em vidro com adesivagem similar.<br><br><strong><span style=\"color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit;\">Quadros de vidro tem muitas vantagens, dentre elas:</span></strong></p>\n<p>- São mais bonitos<br>- São mais discretos<br>- Eles encaixam melhor na sua decoração<br>- São fáceis de limpar<br>- São simples de instalar<br>- Qualquer vidraçaria faz<br><br><strong>Alguns cuidados ao comprar na vidraçaria</strong><br><br>- Sempre use vidro temperado, especialmente se tem crianças em casa<br>- A espessura mínima é 4mm, mas eu uso de 8mm pra frente<br>- Instale encostado na parede, ele fica mais firme e seguro, sendo mais difícil quebrar<br><br><strong>Opções no mercado</strong></p>\n<p>O pessoal da Easy Office oferece bons quadros de vidro, inclusive magnéticos, algo que não dá para pedir na vidraçaria. Os meus eu comprei na Kalunga.<br><br><strong>Custo vs Benefício dos quadros</strong><br><br>Os quadros de madeira são mais baratos, mas essencialmente tem vida útil menor e com o tempo eles perdem aquela camada de \"verniz\", deixando tudo bem dificil de apagar.<br><br>Os quadros de metal são interessantes, mas geralmente eles tem um tema, é difícil achar um todo branco para comprar, e nas minhas muitas mudanças vários amassaram as pontinhas.<br><br><strong>Dicas soltas</strong><br><br>Não use apagador, prefira panos de microfibra, funciona 1000x melhor.<br><br>Se sua parede é branca, e se instalar encostado na parede, nem precisará de fundo branco adesivado ou pintado – apesar de recomendar para dar uma uniformidade na cor.<br><br>Se for instalar afastado da parede com pinos de 5cm o 10cm, o fundo branco pintado ou adesivado é fundamental para conseguir ler o que escreveu no quadro. Mas é dificil limpar na parte de trás e se apoiar nele pode quebrar, tem que temperar e usar de 8 a 10mm.<br><br><strong>Quadros que nem vemos</strong><br><br>Eu escrevo nas janelas, vidros da varanda e até nos espelhos, essas canetinhas são muito funcionais e uma simples janela pode virar um quadro para deixar uma mensagem, um lembrete ou simplesmente para desenhar e soltar sua criatividade.</p>\n<p><strong>Dicas Kids</strong><br><br>Como as canetas são relativamente caras, especialmente se tratando de crianças, eles acabam com a tinta de 1 kit em uma tarde. Pensando nisso, no quarto das crianças eu pintei em uma parede um quadro usando tinta \"lousa &amp; cor\" da suvinil.</p>\n<figure class=\"post__image\"><img loading=\"lazy\"  src=\"https://gutocarvalho.net/media/posts/72/lousa_kids.jpg\" sizes=\"(min-width: 61.3125em) 50vw, 100vw\" srcset=\"https://gutocarvalho.net/media/posts/72/responsive/lousa_kids-xs.jpg 300w ,https://gutocarvalho.net/media/posts/72/responsive/lousa_kids-sm.jpg 480w ,https://gutocarvalho.net/media/posts/72/responsive/lousa_kids-md.jpg 768w\"  alt=\"\" width=\"960\" height=\"1280\"></figure><br><br>Esse é o quarto/brinquedoteca/sala de estudo aq de casa, quando as crianças vem pra cá usam esse espaço para tudo, inclusive para desenhar.</p>\n<p>Nessa parede eles podem escrever com giz normal ou giz líquido. As canetinhas de giz líquido duram bem mais que as canetinhas de quadro branco, tenho usado da marca <a href=\"https://b2b.brwsuprimentos.com.br/produto/listar/giz-liquido-o\">BRW.</a></p>\n<p>A grande vantagem é que quando acaba o Giz Líquido eles continuam com o giz normal, que é baratinho :)<br><br>Espero que gostem das dicas!<br><br>[s]</p>\n<p> </p>\n<p> </p>",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "Casa"
            ],
            "date_published": "2021-11-05T14:04:25-03:00",
            "date_modified": "2021-11-06T06:28:30-03:00"
        },
        {
            "id": "https://gutocarvalho.net/criando-um-cluster-k8s-com-eksctl/",
            "url": "https://gutocarvalho.net/criando-um-cluster-k8s-com-eksctl/",
            "title": "DROPS: Criando um Cluster K8S com EKSCTL",
            "summary": "Aprende aí como fazer isso com uma mão nas costas! Criando um&hellip;",
            "content_html": "<p>Aprende aí como fazer isso com uma mão nas costas!</p>\n<hr>\n<p>Criando um cluster para testes de forma rápida e rasteira, vamo nessa!</p>\n<pre><code>$ eksctl create cluster \\\n    --region us-east-1 \\\n    --name falagutera \\\n    --version 1.21 \\\n    --node-type t3.xlarge \\\n    --nodes 3 \\\n    --ssh-public-key &quot;~/nativetrail.pub&quot;\n</code></pre>\n<p>gerando o kubeconfig</p>\n<pre><code>$ aws eks --region us-east-1 update-kubeconfig --name falagutera\n$ export KUBECONFIG=config\n</code></pre>\n<p>checando o cluster baby</p>\n<pre><code>$ kubectl get nodes\n</code></pre>\n<p>terminou o teste? bora derrubar tudo!</p>\n<pre><code>$ eksctl delete cluster falagutera\n</code></pre>\n<p>pronto!</p>\n",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "K8S",
                   "Drops"
            ],
            "date_published": "2021-11-02T09:48:13-03:00",
            "date_modified": "2021-11-02T11:37:55-03:00"
        },
        {
            "id": "https://gutocarvalho.net/usando-efs-em-um-cluster-k8s-ec2/",
            "url": "https://gutocarvalho.net/usando-efs-em-um-cluster-k8s-ec2/",
            "title": "DROPS: Usando EFS em um Cluster K8S EC2",
            "summary": "Aprenda a usar o EFS Provisioner em um Cluster K8S EC2/RKE. São&hellip;",
            "content_html": "<p>Aprenda a usar o EFS Provisioner em um Cluster K8S EC2/RKE.</p>\n<hr>\n<h3 id=\"o-que-são-drops\">O que são drops?</h3>\n<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>\n<p>Geralmente de algo que eu acabei de fazer.</p>\n<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>\n<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>\n<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>\n<h3 id=\"veio-a-demanda\">Veio a Demanda!</h3>\n<p>A ideia é instalar um EFS Provisioner no cluster para poder subir APPS que montam o mesmo volume em diferentes PODs.</p>\n<h3 id=\"então-comofaz\">Então ComoFaz?</h3>\n<p>Crie o arquivo instala_efs_provisioner.yaml</p>\n<pre><code>vim aplica.yaml\n</code></pre>\n<p>Insira o conteúdo abaixo</p>\n<pre><code>---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: efs-provisioner-runner\nrules:\n  - apiGroups: [&quot;&quot;]\n    resources: [&quot;persistentvolumes&quot;]\n    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;delete&quot;]\n  - apiGroups: [&quot;&quot;]\n    resources: [&quot;persistentvolumeclaims&quot;]\n    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;update&quot;]\n  - apiGroups: [&quot;storage.k8s.io&quot;]\n    resources: [&quot;storageclasses&quot;]\n    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]\n  - apiGroups: [&quot;&quot;]\n    resources: [&quot;events&quot;]\n    verbs: [&quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-efs-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: efs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: efs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-efs-provisioner\nrules:\n  - apiGroups: [&quot;&quot;]\n    resources: [&quot;endpoints&quot;]\n    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-efs-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: efs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: Role\n  name: leader-locking-efs-provisioner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: efs-provisioner\n---\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  name: efs-provisioner\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: efs-provisioner\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: efs-provisioner\n    spec:\n      serviceAccount: efs-provisioner\n      containers:\n        - name: efs-provisioner\n          image: quay.io/external_storage/efs-provisioner:latest\n          env:\n            - name: FILE_SYSTEM_ID\n              valueFrom:\n                configMapKeyRef:\n                  name: efs-provisioner\n                  key: file.system.id\n            - name: AWS_REGION\n              valueFrom:\n                configMapKeyRef:\n                  name: efs-provisioner\n                  key: aws.region\n            - name: DNS_NAME\n              valueFrom:\n                configMapKeyRef:\n                  name: efs-provisioner\n                  key: dns.name\n                  optional: true\n            - name: PROVISIONER_NAME\n              valueFrom:\n                configMapKeyRef:\n                  name: efs-provisioner\n                  key: provisioner.name\n          volumeMounts:\n            - name: pv-volume\n              mountPath: /persistentvolumes\n      volumes:\n        - name: pv-volume\n          nfs:\n            server: fs-&lt;ID DO SEU EFS&gt;.efs.&lt;REGIAO AWS&gt;.amazonaws.com\n            path: /\n---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: aws-efs\nprovisioner: nativetrail.io/aws-efs\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: efs-provisioner\ndata:\n  file.system.id: fs-&lt;ID DO SEU EFS&gt;\n  aws.region: &lt;REGIAO AWS&gt;\n  provisioner.name: nativetrail.io/aws-efs\n  dns.name: &quot;&quot;\n</code></pre>\n<p>Ajuste o ID do seu EFS e região da AWS no manifesto acima, e prestenção, tem que o usar o namespace <strong>kube-system</strong> pois ele é especificado nas <strong>roles</strong> e <strong>serviceaccount</strong>, se instalar o deployment em outro namespace não vai funcionar.</p>\n<pre><code>kubectl apply -f instala_efs_provisioner.yaml -n kube-system\n    \n</code></pre>\n<p>Pronto, vamos verificar</p>\n<pre><code>kubectl get sc\n</code></pre>\n<p>Saída esperada</p>\n<pre><code>NAME                PROVISIONER              RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\naws-efs             nativetrail.io/aws-efs   Delete          Immediate           false                  43m\naws-ebs (default)   ebs.csi.aws.com          Delete          Immediate           false                  3d16h\n</code></pre>\n<p>agora vamos testar, crie o manifesto valida-pod-efs.ym com o conteúdo abaixo</p>\n<pre><code>---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: valida-aws-efs\nspec:\n  accessModes:\n    - ReadWriteMany\n  storageClassName: aws-efs\n  resources:\n    requests:\n      storage: 1Gi\n</code></pre>\n<p>aplique</p>\n<pre><code>kubectl apply -f pod-efs.yaml\n</code></pre>\n<p>saída</p>\n<pre><code>persistentvolumeclaim/valida-aws-efs created\n</code></pre>\n<p>vamos ver</p>\n<pre><code>kubectl get pvc valida-aws-efs\n</code></pre>\n<p>saída</p>\n<pre><code>NAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nvalida-aws-efs   Bound    pvc-c524234f-4b07-4248-b328-c6c164dddbc2   1Gi        RWX            aws-efs        3m42s\n</code></pre>\n<p>agora com mais detalhes</p>\n<pre><code>kubectl describe pvc valida-aws-efs\n</code></pre>\n<p>saída</p>\n<pre><code>Name:          valida-aws-efs\nNamespace:     default\nStorageClass:  aws-efs\nStatus:        Bound\nVolume:        pvc-c524234f-4b07-4248-b328-c6c164dddbc2\nLabels:        &lt;none&gt;\nAnnotations:   pv.kubernetes.io/bind-completed: yes\n               pv.kubernetes.io/bound-by-controller: yes\n               volume.beta.kubernetes.io/storage-provisioner: nativetrail.io/aws-efs\nFinalizers:    [kubernetes.io/pvc-protection]\nCapacity:      1Gi\nAccess Modes:  RWX\nVolumeMode:    Filesystem\nUsed By:       &lt;none&gt;\nEvents:\n  Type    Reason                 Age                    From                                                                                   Message\n  ----    ------                 ----                   ----                                                                                   -------\n  Normal  Provisioning           3m49s                  nativetrail.io/aws-efs_efs-provisioner-644f9f8c8c-n6n48_be97e87c-7e5b-4b42-8756-2adb23a5a105  External provisioner is provisioning volume for claim &quot;default/valida-aws-efs&quot;\n  Normal  ProvisioningSucceeded  3m49s                  nativetrail.io/aws-efs_efs-provisioner-644f9f8c8c-n6n48_be97e87c-7e5b-4b42-8756-2adb23a5a105  Successfully provisioned volume pvc-c524234f-4b07-4248-b328-c6c164dddbc2\n</code></pre>\n<p>Perfeito, tudo funcionando, agora é só usar!</p>\n<p>:)</p>\n<h3 id=\"refs\">refs</h3>\n<ul>\n<li><a href=\"https://github.com/rancher/rke\">https://github.com/rancher/rke</a></li>\n<li><a href=\"https://kubernetes.io/pt-br/\">https://kubernetes.io/pt-br/</a></li>\n<li><a href=\"https://aws.amazon.com/efs/\">https://aws.amazon.com/efs/</a></li>\n<li><a href=\"https://github.com/kubernetes-retired/external-storage/tree/master/aws/efs\">https://github.com/kubernetes-retired/external-storage/tree/master/aws/efs</a></li>\n<li><a href=\"https://icicimov.github.io/blog/virtualization/Kubernetes-NFS-shared-storage-in-AWS-with-EFS/\">https://icicimov.github.io/blog/virtualization/Kubernetes-NFS-shared-storage-in-AWS-with-EFS/</a></li>\n</ul>\n",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "K8S",
                   "Drops"
            ],
            "date_published": "2021-10-24T11:06:27-03:00",
            "date_modified": "2021-10-25T08:03:34-03:00"
        },
        {
            "id": "https://gutocarvalho.net/centralizando-logs-do-k8s-com-o-loki/",
            "url": "https://gutocarvalho.net/centralizando-logs-do-k8s-com-o-loki/",
            "title": "DROPS: Centralizando Logs do K8S com o Loki",
            "summary": "Aprenda a instalar o LOKI da GrafanaLabs para centralizar Logs do K8S.",
            "content_html": "<p>Aprenda a instalar o LOKI da GrafanaLabs para centralizar Logs do K8S.</p>\n<hr>\n<h3 id=\"o-que-são-drops\">O que são drops?</h3>\n<p>São DUMPs mentais rápidos e rasteiros, simples e objetivos – que funcionam. </p>\n<p>Geralmente de algo que eu acabei de fazer.</p>\n<p>Eu – quase sempre – volto para detalhar mais cada passo.</p>\n<p>Considere com a mesma qualidade de um rascunho ou uma anotação rápida.</p>\n<p>De qualquer forma comenta ai qquer coisa, os comentários estão ligados nos DROPS ;)</p>\n<h3 id=\"demanda\">Demanda!</h3>\n<p>A ideia é instalar um Loki no cluster K8S e começar a centralizar e consumir os logs via dashboard do grafana.</p>\n<h3 id=\"por-que-o-loki\">Por que o Loki?</h3>\n<p>O Loki é leve – em resumo esse é o maior e melhor motivo para usar ele.</p>\n<p>Comparando com outras STACKS, ele nao leva 1/3 ou 2/3 do seu cluster só para centralizar logs.</p>\n<p>Você acompanha os logs pelo Grafana Dashboard, simples e direto.</p>\n<p>Além disso o projeto tem 14 mil estrelas no GitHub e mais de 400 contribuidores :)</p>\n<p>Conheça mais do projeto, dá um chance vai :)</p>\n<ul>\n<li><a href=\"https://grafana.com/docs/loki/latest/overview/\">https://grafana.com/docs/loki/latest/overview/</a></li>\n<li><a href=\"https://grafana.com/docs/loki/latest/overview/comparisons/\">https://grafana.com/docs/loki/latest/overview/comparisons/</a></li>\n</ul>\n<h3 id=\"antes-de-começar\">Antes de começar</h3>\n<p>Estou partindo do pressuposto de que você não tem o grafana instalado!</p>\n<p>Precisa ter o Helm instalado e um cluster k8s funcional.</p>\n<h3 id=\"então-comofaz\">Então ComoFaz?</h3>\n<p>adicione o repositorio e atualize os índices</p>\n<pre><code>helm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update\n</code></pre>\n<p>instale o loki</p>\n<pre><code>helm upgrade --install loki --namespace=loki grafana/loki alertmanager.persistentVolume.enabled=true\n</code></pre>\n<p>instale o grafana</p>\n<pre><code>helm install loki-grafana grafana/grafana\n</code></pre>\n<p>pegue a senha de admin do grafana</p>\n<pre><code>kubectl get secret --namespace &lt;YOUR-NAMESPACE&gt; loki-grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo\n</code></pre>\n<p>crie um port-forward para acessar o grafana</p>\n<pre><code>kubectl port-forward --namespace &lt;YOUR-NAMESPACE&gt; service/loki-grafana 3000:80\n</code></pre>\n<p>acesse o grafana</p>\n<pre><code>http://localhost:3000\n</code></pre>\n<p>adicione o datasource conforme a doc abaixo</p>\n<ul>\n<li><a href=\"https://grafana.com/docs/loki/latest/getting-started/grafana/\">https://grafana.com/docs/loki/latest/getting-started/grafana/</a></li>\n</ul>\n<p>Pronto, divirta-se!</p>\n<h3 id=\"refs\">Refs</h3>\n<ul>\n<li><a href=\"https://grafana.com/docs/loki/latest/installation/helm/\">https://grafana.com/docs/loki/latest/installation/helm/</a></li>\n<li><a href=\"https://grafana.com/go/webinar/loki-getting-started-emea\">https://grafana.com/go/webinar/loki-getting-started-emea</a></li>\n<li><a href=\"https://grafana.com/blog/2020/10/28/loki-2.0-released-transform-logs-as-youre-querying-them-and-set-up-alerts-within-loki\">https://grafana.com/blog/2020/10/28/loki-2.0-released-transform-logs-as-youre-querying-them-and-set-up-alerts-within-loki</a></li>\n</ul>\n",
            "author": {
                "name": "Guto Carvalho"
            },
            "tags": [
                   "Projetos",
                   "Drops"
            ],
            "date_published": "2021-10-22T09:43:24-03:00",
            "date_modified": "2021-10-22T09:47:50-03:00"
        }
    ]
}
